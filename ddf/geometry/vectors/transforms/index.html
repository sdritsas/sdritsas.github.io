
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Stylianos Dritsas">
      
      
      
        <link rel="prev" href="../systems/">
      
      
        <link rel="next" href="../../curves/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>Transformations - Digital Design and Fabrication</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22c5.5 0 10-4.5 10-10S17.5 2 12 2 2 6.5 2 12s4.5 10 10 10M11 7h2v2h-2zm3 10h-4v-2h1v-2h-1v-2h3v4h1z"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#transformations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Digital Design and Fabrication" class="md-header__button md-logo" aria-label="Digital Design and Fabrication" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 2 4 4h-3v7.85l6.53 3.76L21 15.03l1.5 5.47-5.5 1.46 1.53-2.61L12 15.58l-6.53 3.77L7 21.96 1.5 20.5 3 15.03l1.47 2.58L11 13.85V6H8z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Digital Design and Fabrication
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Transformations
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Digital Design and Fabrication" class="md-nav__button md-logo" aria-label="Digital Design and Fabrication" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 2 4 4h-3v7.85l6.53 3.76L21 15.03l1.5 5.47-5.5 1.46 1.53-2.61L12 15.58l-6.53 3.77L7 21.96 1.5 20.5 3 15.03l1.47 2.58L11 13.85V6H8z"/></svg>

    </a>
    Digital Design and Fabrication
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Parametrics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Parametrics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../parametrics/components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Components
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../parametrics/template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Template
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../parametrics/cpython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPython
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Programming
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/collections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Collections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Objects
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Geometry
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Geometry
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vectors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Vectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../distances/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../addition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Addition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../subtraction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subtraction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiplication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiplication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normalize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Normalization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dot-product/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dot Product
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cross-product/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross Product
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coordinate Systems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Transformations
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Transformations
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#matrix-transforms" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Transforms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Matrix Transforms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basis-vectors" class="md-nav__link">
    <span class="md-ellipsis">
      Basis Vectors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#matrix-point" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#matrix-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Matrix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#translation" class="md-nav__link">
    <span class="md-ellipsis">
      Translation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scaling" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uniform" class="md-nav__link">
    <span class="md-ellipsis">
      Uniform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-uniform" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Uniform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reflection" class="md-nav__link">
    <span class="md-ellipsis">
      Reflection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Rotation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#axis-angle" class="md-nav__link">
    <span class="md-ellipsis">
      Axis Angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#euler-angles" class="md-nav__link">
    <span class="md-ellipsis">
      Euler Angles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quaternions" class="md-nav__link">
    <span class="md-ellipsis">
      Quaternions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-inverse" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Inverse
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basis-to-basis" class="md-nav__link">
    <span class="md-ellipsis">
      Basis to Basis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversions" class="md-nav__link">
    <span class="md-ellipsis">
      Conversions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Curves
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Curves
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../curves/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../curves/euclidean/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Euclidean
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../curves/computational/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computational
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Surfaces
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Surfaces
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../surfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../surfaces/euclidean/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Euclidean
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../surfaces/computational/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computational
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Meshes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Meshes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meshes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meshes/topology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topology
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Solids
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Solids
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solids/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solids/constructive/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Constructive
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solids/boundary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Boundary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solids/voxels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Volumetric
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solids/clouds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Point Clouds
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Constructions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Constructions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/angles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Angles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/areas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Areas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/centroids/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Centroids
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/clashes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clashes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/containment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/mappings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mappings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/offsets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Offsets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/perpendiculars/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perpendiculars
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/polygons/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Polygons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/projections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Projections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constructions/reflections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reflections
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#matrix-transforms" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Transforms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Matrix Transforms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basis-vectors" class="md-nav__link">
    <span class="md-ellipsis">
      Basis Vectors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#matrix-point" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#matrix-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Matrix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#translation" class="md-nav__link">
    <span class="md-ellipsis">
      Translation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scaling" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uniform" class="md-nav__link">
    <span class="md-ellipsis">
      Uniform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-uniform" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Uniform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reflection" class="md-nav__link">
    <span class="md-ellipsis">
      Reflection
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Rotation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#axis-angle" class="md-nav__link">
    <span class="md-ellipsis">
      Axis Angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#euler-angles" class="md-nav__link">
    <span class="md-ellipsis">
      Euler Angles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quaternions" class="md-nav__link">
    <span class="md-ellipsis">
      Quaternions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-inverse" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Inverse
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basis-to-basis" class="md-nav__link">
    <span class="md-ellipsis">
      Basis to Basis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversions" class="md-nav__link">
    <span class="md-ellipsis">
      Conversions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="transformations">Transformations</h1>
<p>This section introduces matrix operations associated with geometric transformations such as translation, scaling, reflection and rotation. Technically matrices are not required for performing geometric transformations. Vector addition and multiplication suffice for 99.9% of geometric constructions. This content is presented because matrices are extremely common and thus it is beneficial to develop some familiarity.</p>
<h2 id="matrix-transforms">Matrix Transforms</h2>
<p>Linear algebra matrices provide the mechanism for expressing geometric transformations. There are a few reasons for using them including: (a) they unify every possible linear transformations in one representation, (b) they allow for combining several consecutive transformations in one data structure, (c) modern GPUs provide hardware acceleration for matrix transformations.</p>
<h3 id="basis-vectors">Basis Vectors</h3>
<p>In computational geometry, square matrices are mostly used such as 2x2, 3x3 and 4x4. One interpretation for such matrices is that they just provide a convenient data structure for grouping the basis vectors of a coordinate system.</p>
<p>A basis is defined in 3D by its three orthonormal vectors <code>X = [Xx, Xy, Xz]</code>, <code>Y = [Yx, Yy, Yz]</code>, and <code>Z = [Zx, Zy, Zz]</code>. A 3x3 matrix captures these vectors in a compact representation as seen below. Note that the vectors are arranged in columns but often shown in rows.</p>
<div class="highlight"><pre><span></span><code><span id="__span-0-1"><span class="sd">&quot;&quot;&quot; General Basis 3D</span>
</span><span id="__span-0-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-3"><span class="n">xform</span>  <span class="o">=</span> <span class="p">[[</span> <span class="n">Xx</span><span class="p">,</span> <span class="n">Yx</span><span class="p">,</span> <span class="n">Zx</span> <span class="p">],</span>
</span><span id="__span-0-4">          <span class="p">[</span> <span class="n">Xy</span><span class="p">,</span> <span class="n">Yy</span><span class="p">,</span> <span class="n">Zy</span> <span class="p">],</span>
</span><span id="__span-0-5">          <span class="p">[</span> <span class="n">Xz</span><span class="p">,</span> <span class="n">Yz</span><span class="p">,</span> <span class="n">Zz</span> <span class="p">]]</span>
</span><span id="__span-0-6">
</span><span id="__span-0-7"><span class="sd">&quot;&quot;&quot; World Basis 3D</span>
</span><span id="__span-0-8"><span class="sd">    Identity Matrix</span>
</span><span id="__span-0-9"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-10"><span class="n">world</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span id="__span-0-11">         <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span id="__span-0-12">         <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
</span></code></pre></div>
<p>While this captures the basis vectors, it misses the origin point <code>O = [Ox, Oy, Oz]</code> or translation. Therefore, the matrix representation is expanded with an additional column to host the origin and a row to keep the matrix square. Adding the last row is for computational convenience, namely performing matrix multiplications. Note that for the basis <code>X</code>, <code>Y</code> and <code>Z</code> column vectors their 4th component is <code>0.0</code> but for the origin or translation vector it is <code>1.0</code>.</p>
<div class="highlight"><pre><span></span><code><span id="__span-1-1"><span class="sd">&quot;&quot;&quot; General Affine 3D</span>
</span><span id="__span-1-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-1-3"><span class="n">xform</span>  <span class="o">=</span> <span class="p">[[</span> <span class="n">Xx</span><span class="p">,</span> <span class="n">Yx</span><span class="p">,</span> <span class="n">Zx</span><span class="p">,</span> <span class="n">Ox</span> <span class="p">],</span>
</span><span id="__span-1-4">          <span class="p">[</span> <span class="n">Xy</span><span class="p">,</span> <span class="n">Yy</span><span class="p">,</span> <span class="n">Zy</span><span class="p">,</span> <span class="n">Oy</span> <span class="p">],</span>
</span><span id="__span-1-5">          <span class="p">[</span> <span class="n">Xz</span><span class="p">,</span> <span class="n">Yz</span><span class="p">,</span> <span class="n">Zz</span><span class="p">,</span> <span class="n">Oz</span> <span class="p">],</span>
</span><span id="__span-1-6">          <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span>   <span class="mi">1</span> <span class="p">]]</span>
</span><span id="__span-1-7">
</span><span id="__span-1-8"><span class="sd">&quot;&quot;&quot; World Affine 3D</span>
</span><span id="__span-1-9"><span class="sd">    Identity Matrix</span>
</span><span id="__span-1-10"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-1-11"><span class="n">world</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span id="__span-1-12">         <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span id="__span-1-13">         <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span id="__span-1-14">         <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
</span></code></pre></div>
<p>There are several variations for encoding a matrix using programming language constructs. The representation above is known as row-major style because the first subscript is the row and second is the column when using <code>matrix[row][col]</code>. Its transpose is known as column-major. GPUs prefer flat lists instead of nested lists. It is also possible to encode a matrix as a class containing four column vector members as seen below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-2-1"><span class="sd">&quot;&quot;&quot; Transformation Matrix Column</span>
</span><span id="__span-2-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-2-3"><span class="k">class</span><span class="w"> </span><span class="nc">Vec4</span><span class="p">:</span>
</span><span id="__span-2-4">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span> <span class="p">):</span>
</span><span id="__span-2-5">        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="__span-2-6">        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="__span-2-7">        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">z</span>
</span><span id="__span-2-8">        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">w</span>
</span><span id="__span-2-9">
</span><span id="__span-2-10"><span class="sd">&quot;&quot;&quot; Transformation Matrix</span>
</span><span id="__span-2-11"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-2-12"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-2-13">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-2-14">            <span class="n">xx</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">yx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-2-15">            <span class="n">xy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-2-16">            <span class="n">xz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-2-17">            <span class="n">xw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="p">):</span>
</span><span id="__span-2-18">        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span> <span class="n">xx</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">xz</span><span class="p">,</span> <span class="n">xw</span> <span class="p">)</span>
</span><span id="__span-2-19">        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span> <span class="n">yx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">yw</span> <span class="p">)</span>
</span><span id="__span-2-20">        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">zw</span> <span class="p">)</span>
</span><span id="__span-2-21">        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">ww</span> <span class="p">)</span>
</span><span id="__span-2-22">
</span><span id="__span-2-23"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Identity Matrix</span>
</span><span id="__span-2-24"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-2-25">    <span class="nd">@staticmethod</span>
</span><span id="__span-2-26">    <span class="k">def</span><span class="w"> </span><span class="nf">Identity</span><span class="p">(</span> <span class="p">):</span>
</span><span id="__span-2-27">        <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span> <span class="p">)</span>
</span><span id="__span-2-28">
</span><span id="__span-2-29"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Matrix from Basis</span>
</span><span id="__span-2-30"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-2-31">    <span class="nd">@staticmethod</span>
</span><span id="__span-2-32">    <span class="k">def</span><span class="w"> </span><span class="nf">Basis</span><span class="p">(</span> <span class="n">o</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="p">):</span>
</span><span id="__span-2-33">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span> <span class="n">x</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
</span><span id="__span-2-34">                       <span class="n">x</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span>
</span><span id="__span-2-35">                       <span class="n">x</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="__span-2-36">                       <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">)</span>
</span><span id="__span-2-37">
</span><span id="__span-2-38"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Matrix from Plane</span>
</span><span id="__span-2-39"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-2-40">    <span class="nd">@staticmethod</span>
</span><span id="__span-2-41">    <span class="k">def</span><span class="w"> </span><span class="nf">Plane</span><span class="p">(</span> <span class="n">o</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">):</span>
</span><span id="__span-2-42">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Basis</span><span class="p">(</span> <span class="n">o</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
</span><span id="__span-2-43">            <span class="ne">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span> <span class="p">)</span>
</span></code></pre></div>
<p>In Rhino 4x4 transformation matrices are represented by the <code>Transform</code> class, see also the <a href="https://developer.rhino3d.com/api/rhinocommon/rhino.geometry.transform">documentation</a>. <code>Transform</code> objects support several useful operations that can be performed. Manually constructing and editing matrices is rather demotivated by Rhino but there are still some methods for accessing a matrix's elements as seen below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-3-1"><span class="sd">&quot;&quot;&quot; Create World Basis</span>
</span><span id="__span-3-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-3-3"><span class="n">world</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Identity</span>
</span><span id="__span-3-4">
</span><span id="__span-3-5"><span class="sd">&quot;&quot;&quot; Getting [row, col]</span>
</span><span id="__span-3-6"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-3-7"><span class="nb">print</span><span class="p">(</span> <span class="n">world</span><span class="o">.</span><span class="n">Item</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="p">)</span>
</span><span id="__span-3-8">
</span><span id="__span-3-9"><span class="sd">&quot;&quot;&quot; Setting [row, col]</span>
</span><span id="__span-3-10"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-3-11"><span class="n">world</span><span class="o">.</span><span class="n">Item</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span></code></pre></div>
<h3 id="matrix-point">Matrix Point</h3>
<p>The multiplication of matrices with points and vectors captures the process of transforming them. The process involves computing three dot products which represent the transformed coordinates or components.</p>
<div class="highlight"><pre><span></span><code><span id="__span-4-1"><span class="sd">&quot;&quot;&quot; Transformation Matrix M</span>
</span><span id="__span-4-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-4-3"><span class="n">M</span> <span class="o">=</span> <span class="p">[[</span> <span class="n">Xx</span><span class="p">,</span> <span class="n">Yx</span><span class="p">,</span> <span class="n">Zx</span><span class="p">,</span> <span class="n">Ox</span> <span class="p">],</span>
</span><span id="__span-4-4">     <span class="p">[</span> <span class="n">Xy</span><span class="p">,</span> <span class="n">Yy</span><span class="p">,</span> <span class="n">Zy</span><span class="p">,</span> <span class="n">Oy</span> <span class="p">],</span>
</span><span id="__span-4-5">     <span class="p">[</span> <span class="n">Xz</span><span class="p">,</span> <span class="n">Yz</span><span class="p">,</span> <span class="n">Zz</span><span class="p">,</span> <span class="n">Oz</span> <span class="p">],</span>
</span><span id="__span-4-6">     <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span>   <span class="mi">1</span> <span class="p">]]</span>
</span><span id="__span-4-7">
</span><span id="__span-4-8"><span class="sd">&quot;&quot;&quot; Matrix Point Product q = M x p</span>
</span><span id="__span-4-9"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-4-10"><span class="n">p</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-4-11"><span class="n">q</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span>
</span><span id="__span-4-12">     <span class="n">Xx</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="n">Yx</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="n">Zx</span> <span class="o">*</span> <span class="n">pz</span> <span class="o">+</span> <span class="n">Ox</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="__span-4-13">     <span class="n">Xy</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="n">Yy</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="n">Zy</span> <span class="o">*</span> <span class="n">pz</span> <span class="o">+</span> <span class="n">Oy</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="__span-4-14">     <span class="n">Xz</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="n">Yz</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="n">Zz</span> <span class="o">*</span> <span class="n">pz</span> <span class="o">+</span> <span class="n">Oz</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="p">)</span>
</span><span id="__span-4-15">
</span><span id="__span-4-16"><span class="sd">&quot;&quot;&quot; Matrix Vector Product v = M x u</span>
</span><span id="__span-4-17"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-4-18"><span class="n">u</span> <span class="o">=</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span> <span class="p">)</span>
</span><span id="__span-4-19"><span class="n">v</span> <span class="o">=</span> <span class="ne">Vector3d</span><span class="p">(</span>
</span><span id="__span-4-20">     <span class="n">Xx</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">Yx</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">Zx</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">Ox</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-4-21">     <span class="n">Xy</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">Yy</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">Zy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">Oy</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-4-22">     <span class="n">Xz</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">Yz</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">Zz</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">Oz</span> <span class="o">*</span> <span class="mf">0.0</span> <span class="p">)</span>
</span></code></pre></div>
<p>Point and vector multiplication by a matrix is slightly different even though the same notation is used. A point <code>p</code> with coordinates <code>[px, py, pz]</code> is converted to <code>[px, py, pz, 1.0]</code> while a vector <code>u</code> with components <code>[ux, uy, uz]</code> is converted to <code>[ux, uy, uz, 0.0]</code> before being multiplied with a transformation matrix. This is because vectors do not convey the notion of position but only direction, therefore the 4th column of the matrix which conveys position or translation, must not be used. Only the upper-left 3x3 sub-matrix is relevant to vectors. The value of <code>0.0</code> or <code>1.0</code> in the 4th element is therefore used as a mask to apply or not the translation.</p>
<div class="highlight"><pre><span></span><code><span id="__span-5-1"><span class="sd">&quot;&quot;&quot; Point and Vector Transformation</span>
</span><span id="__span-5-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-5-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-5-4">    <span class="k">def</span><span class="w"> </span><span class="nf">MatrixPointProduct</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">point</span> <span class="p">):</span>
</span><span id="__span-5-5">          <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">zx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span>
</span><span id="__span-5-6">          <span class="n">xy</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span>
</span><span id="__span-5-7">          <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-5-8">          <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">oz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-5-9">
</span><span id="__span-5-10">          <span class="k">return</span> <span class="ne">Point3d</span><span class="p">(</span>
</span><span id="__span-5-11">               <span class="n">ox</span> <span class="o">+</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">yx</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">zx</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="__span-5-12">               <span class="n">oy</span> <span class="o">+</span> <span class="n">xy</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="__span-5-13">               <span class="n">oz</span> <span class="o">+</span> <span class="n">xz</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">yz</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">zz</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span><span id="__span-5-14">
</span><span id="__span-5-15">     <span class="k">def</span><span class="w"> </span><span class="nf">MatrixVectorProduct</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">vector</span> <span class="p">):</span>
</span><span id="__span-5-16">          <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">zx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span>
</span><span id="__span-5-17">          <span class="n">xy</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span>
</span><span id="__span-5-18">          <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-5-19">
</span><span id="__span-5-20">          <span class="k">return</span> <span class="ne">Vector3d</span><span class="p">(</span>
</span><span id="__span-5-21">               <span class="n">xx</span> <span class="o">*</span> <span class="n">vector</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">yx</span> <span class="o">*</span> <span class="n">vector</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">zx</span> <span class="o">*</span> <span class="n">vector</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="__span-5-22">               <span class="n">xy</span> <span class="o">*</span> <span class="n">vector</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">vector</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">vector</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="__span-5-23">               <span class="n">xz</span> <span class="o">*</span> <span class="n">vector</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">yz</span> <span class="o">*</span> <span class="n">vector</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">zz</span> <span class="o">*</span> <span class="n">vector</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span></code></pre></div>
<p>In Rhino there are two ways to perform matrix times point or vector multiplication as seen below. Using the multiplication operator <code>*</code> produces a new point or vector, while using the point's or vector's <code>Transform( )</code> method modifies the point or vector in-place. Note that while <code>M * p</code> is supported, the reverse <code>p * M</code> raises an exception.</p>
<div class="highlight"><pre><span></span><code><span id="__span-6-1"><span class="sd">&quot;&quot;&quot; Matrix and Point</span>
</span><span id="__span-6-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-3"><span class="n">M</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Identity</span>
</span><span id="__span-6-4"><span class="n">p</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
</span><span id="__span-6-5">
</span><span id="__span-6-6"><span class="sd">&quot;&quot;&quot; Transform -&gt; Creates new point</span>
</span><span id="__span-6-7"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-8"><span class="n">q</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">p</span>
</span><span id="__span-6-9">
</span><span id="__span-6-10"><span class="sd">&quot;&quot;&quot; Transform -&gt; Modifies in-place</span>
</span><span id="__span-6-11"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-12"><span class="n">p</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span> <span class="n">M</span> <span class="p">)</span>
</span></code></pre></div>
<h3 id="matrix-matrix">Matrix Matrix</h3>
<p>Multiplication between two 4x4 matrices produces a new 4x4 matrix that encodes the combined or compounded transformation. You may recall that multiplication between two matrices <code>A</code> and <code>B</code> is not commutative, that is <code>A x B != B x A</code>.</p>
<div class="highlight"><pre><span></span><code><span id="__span-7-1"><span class="sd">&quot;&quot;&quot; Matrix Multiplication</span>
</span><span id="__span-7-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-7-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-7-4">     <span class="k">def</span><span class="w"> </span><span class="nf">MatrixMatrixProduct</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">that</span> <span class="p">):</span>
</span><span id="__span-7-5"><span class="w">          </span><span class="sd">&quot;&quot;&quot; Unpack Matrix Elements</span>
</span><span id="__span-7-6"><span class="sd">          &quot;&quot;&quot;</span>
</span><span id="__span-7-7">          <span class="n">sxx</span><span class="p">,</span> <span class="n">syx</span><span class="p">,</span> <span class="n">szx</span><span class="p">,</span> <span class="n">swx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span>
</span><span id="__span-7-8">          <span class="n">sxy</span><span class="p">,</span> <span class="n">syy</span><span class="p">,</span> <span class="n">szy</span><span class="p">,</span> <span class="n">swy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span>
</span><span id="__span-7-9">          <span class="n">sxz</span><span class="p">,</span> <span class="n">syz</span><span class="p">,</span> <span class="n">szz</span><span class="p">,</span> <span class="n">swz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-7-10">          <span class="n">sxw</span><span class="p">,</span> <span class="n">syw</span><span class="p">,</span> <span class="n">szw</span><span class="p">,</span> <span class="n">sww</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-7-11">
</span><span id="__span-7-12">          <span class="n">txx</span><span class="p">,</span> <span class="n">tyx</span><span class="p">,</span> <span class="n">tzx</span><span class="p">,</span> <span class="n">twx</span> <span class="o">=</span> <span class="n">that</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span>
</span><span id="__span-7-13">          <span class="n">txy</span><span class="p">,</span> <span class="n">tyy</span><span class="p">,</span> <span class="n">tzy</span><span class="p">,</span> <span class="n">twy</span> <span class="o">=</span> <span class="n">that</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span>
</span><span id="__span-7-14">          <span class="n">txz</span><span class="p">,</span> <span class="n">tyz</span><span class="p">,</span> <span class="n">tzz</span><span class="p">,</span> <span class="n">twz</span> <span class="o">=</span> <span class="n">that</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-7-15">          <span class="n">txw</span><span class="p">,</span> <span class="n">tyw</span><span class="p">,</span> <span class="n">tzw</span><span class="p">,</span> <span class="n">tww</span> <span class="o">=</span> <span class="n">that</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-7-16">
</span><span id="__span-7-17"><span class="w">          </span><span class="sd">&quot;&quot;&quot; Product Matrix Elements</span>
</span><span id="__span-7-18"><span class="sd">          &quot;&quot;&quot;</span>
</span><span id="__span-7-19">          <span class="n">rxx</span> <span class="o">=</span> <span class="n">sxx</span> <span class="o">*</span> <span class="n">txx</span> <span class="o">+</span> <span class="n">syx</span> <span class="o">*</span> <span class="n">txy</span> <span class="o">+</span> <span class="n">szx</span> <span class="o">*</span> <span class="n">txz</span> <span class="o">+</span> <span class="n">swx</span> <span class="o">*</span> <span class="n">txw</span>
</span><span id="__span-7-20">          <span class="n">ryx</span> <span class="o">=</span> <span class="n">sxx</span> <span class="o">*</span> <span class="n">tyx</span> <span class="o">+</span> <span class="n">syx</span> <span class="o">*</span> <span class="n">tyy</span> <span class="o">+</span> <span class="n">szx</span> <span class="o">*</span> <span class="n">tyz</span> <span class="o">+</span> <span class="n">swx</span> <span class="o">*</span> <span class="n">tyw</span>
</span><span id="__span-7-21">          <span class="n">rzx</span> <span class="o">=</span> <span class="n">sxx</span> <span class="o">*</span> <span class="n">tzx</span> <span class="o">+</span> <span class="n">syx</span> <span class="o">*</span> <span class="n">tzy</span> <span class="o">+</span> <span class="n">szx</span> <span class="o">*</span> <span class="n">tzz</span> <span class="o">+</span> <span class="n">swx</span> <span class="o">*</span> <span class="n">tzw</span>
</span><span id="__span-7-22">          <span class="n">rwx</span> <span class="o">=</span> <span class="n">sxx</span> <span class="o">*</span> <span class="n">twx</span> <span class="o">+</span> <span class="n">syx</span> <span class="o">*</span> <span class="n">twy</span> <span class="o">+</span> <span class="n">szx</span> <span class="o">*</span> <span class="n">twz</span> <span class="o">+</span> <span class="n">swx</span> <span class="o">*</span> <span class="n">tww</span>
</span><span id="__span-7-23">
</span><span id="__span-7-24">          <span class="n">rxy</span> <span class="o">=</span> <span class="n">sxy</span> <span class="o">*</span> <span class="n">txx</span> <span class="o">+</span> <span class="n">syy</span> <span class="o">*</span> <span class="n">txy</span> <span class="o">+</span> <span class="n">szy</span> <span class="o">*</span> <span class="n">txz</span> <span class="o">+</span> <span class="n">swy</span> <span class="o">*</span> <span class="n">txw</span>
</span><span id="__span-7-25">          <span class="n">ryy</span> <span class="o">=</span> <span class="n">sxy</span> <span class="o">*</span> <span class="n">tyx</span> <span class="o">+</span> <span class="n">syy</span> <span class="o">*</span> <span class="n">tyy</span> <span class="o">+</span> <span class="n">szy</span> <span class="o">*</span> <span class="n">tyz</span> <span class="o">+</span> <span class="n">swy</span> <span class="o">*</span> <span class="n">tyw</span>
</span><span id="__span-7-26">          <span class="n">rzy</span> <span class="o">=</span> <span class="n">sxy</span> <span class="o">*</span> <span class="n">tzx</span> <span class="o">+</span> <span class="n">syy</span> <span class="o">*</span> <span class="n">tzy</span> <span class="o">+</span> <span class="n">szy</span> <span class="o">*</span> <span class="n">tzz</span> <span class="o">+</span> <span class="n">swy</span> <span class="o">*</span> <span class="n">tzw</span>
</span><span id="__span-7-27">          <span class="n">rwy</span> <span class="o">=</span> <span class="n">sxy</span> <span class="o">*</span> <span class="n">twx</span> <span class="o">+</span> <span class="n">syy</span> <span class="o">*</span> <span class="n">twy</span> <span class="o">+</span> <span class="n">szy</span> <span class="o">*</span> <span class="n">twz</span> <span class="o">+</span> <span class="n">swy</span> <span class="o">*</span> <span class="n">tww</span>
</span><span id="__span-7-28">
</span><span id="__span-7-29">          <span class="n">rxz</span> <span class="o">=</span> <span class="n">sxz</span> <span class="o">*</span> <span class="n">txx</span> <span class="o">+</span> <span class="n">syz</span> <span class="o">*</span> <span class="n">txy</span> <span class="o">+</span> <span class="n">szz</span> <span class="o">*</span> <span class="n">txz</span> <span class="o">+</span> <span class="n">swz</span> <span class="o">*</span> <span class="n">txw</span>
</span><span id="__span-7-30">          <span class="n">ryz</span> <span class="o">=</span> <span class="n">sxz</span> <span class="o">*</span> <span class="n">tyx</span> <span class="o">+</span> <span class="n">syz</span> <span class="o">*</span> <span class="n">tyy</span> <span class="o">+</span> <span class="n">szz</span> <span class="o">*</span> <span class="n">tyz</span> <span class="o">+</span> <span class="n">swz</span> <span class="o">*</span> <span class="n">tyw</span>
</span><span id="__span-7-31">          <span class="n">rzz</span> <span class="o">=</span> <span class="n">sxz</span> <span class="o">*</span> <span class="n">tzx</span> <span class="o">+</span> <span class="n">syz</span> <span class="o">*</span> <span class="n">tzy</span> <span class="o">+</span> <span class="n">szz</span> <span class="o">*</span> <span class="n">tzz</span> <span class="o">+</span> <span class="n">swz</span> <span class="o">*</span> <span class="n">tzw</span>
</span><span id="__span-7-32">          <span class="n">rwz</span> <span class="o">=</span> <span class="n">sxz</span> <span class="o">*</span> <span class="n">twx</span> <span class="o">+</span> <span class="n">syz</span> <span class="o">*</span> <span class="n">twy</span> <span class="o">+</span> <span class="n">szz</span> <span class="o">*</span> <span class="n">twz</span> <span class="o">+</span> <span class="n">swz</span> <span class="o">*</span> <span class="n">tww</span>
</span><span id="__span-7-33">
</span><span id="__span-7-34">          <span class="n">rxw</span> <span class="o">=</span> <span class="n">sxw</span> <span class="o">*</span> <span class="n">txx</span> <span class="o">+</span> <span class="n">syw</span> <span class="o">*</span> <span class="n">txy</span> <span class="o">+</span> <span class="n">szw</span> <span class="o">*</span> <span class="n">txz</span> <span class="o">+</span> <span class="n">sww</span> <span class="o">*</span> <span class="n">txw</span>
</span><span id="__span-7-35">          <span class="n">ryw</span> <span class="o">=</span> <span class="n">sxw</span> <span class="o">*</span> <span class="n">tyx</span> <span class="o">+</span> <span class="n">syw</span> <span class="o">*</span> <span class="n">tyy</span> <span class="o">+</span> <span class="n">szw</span> <span class="o">*</span> <span class="n">tyz</span> <span class="o">+</span> <span class="n">sww</span> <span class="o">*</span> <span class="n">tyw</span>
</span><span id="__span-7-36">          <span class="n">rzw</span> <span class="o">=</span> <span class="n">sxw</span> <span class="o">*</span> <span class="n">tzx</span> <span class="o">+</span> <span class="n">syw</span> <span class="o">*</span> <span class="n">tzy</span> <span class="o">+</span> <span class="n">szw</span> <span class="o">*</span> <span class="n">tzz</span> <span class="o">+</span> <span class="n">sww</span> <span class="o">*</span> <span class="n">tzw</span>
</span><span id="__span-7-37">          <span class="n">rww</span> <span class="o">=</span> <span class="n">sxw</span> <span class="o">*</span> <span class="n">twx</span> <span class="o">+</span> <span class="n">syw</span> <span class="o">*</span> <span class="n">twy</span> <span class="o">+</span> <span class="n">szw</span> <span class="o">*</span> <span class="n">twz</span> <span class="o">+</span> <span class="n">sww</span> <span class="o">*</span> <span class="n">tww</span>
</span><span id="__span-7-38">
</span><span id="__span-7-39">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span>
</span><span id="__span-7-40">               <span class="n">rxx</span><span class="p">,</span> <span class="n">ryx</span><span class="p">,</span> <span class="n">rzx</span><span class="p">,</span> <span class="n">rwx</span><span class="p">,</span>
</span><span id="__span-7-41">               <span class="n">rxy</span><span class="p">,</span> <span class="n">ryy</span><span class="p">,</span> <span class="n">rzy</span><span class="p">,</span> <span class="n">rwy</span><span class="p">,</span>
</span><span id="__span-7-42">               <span class="n">rxz</span><span class="p">,</span> <span class="n">ryz</span><span class="p">,</span> <span class="n">rzz</span><span class="p">,</span> <span class="n">rwz</span><span class="p">,</span>
</span><span id="__span-7-43">               <span class="n">rxw</span><span class="p">,</span> <span class="n">ryw</span><span class="p">,</span> <span class="n">rzw</span><span class="p">,</span> <span class="n">rww</span> <span class="p">)</span>
</span></code></pre></div>
<p>For geometric transformations this makes sense, because the result of combining a rotation and a translation, for example depends on the order on the order of performing those two operations. Note that the way the multiplication is written <code>A x B</code> is the opposite of the application order, namely first <code>B</code> is applied followed by <code>A</code>, that is read right-to-left.</p>
<div class="highlight"><pre><span></span><code><span id="__span-8-1"><span class="sd">&quot;&quot;&quot; Matrix Multiplication</span>
</span><span id="__span-8-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-8-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-8-4">     <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">that</span> <span class="p">):</span>
</span><span id="__span-8-5">          <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">that</span><span class="p">,</span> <span class="ne">Point3d</span> <span class="p">)</span> <span class="p">):</span>
</span><span id="__span-8-6">               <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MatrixPointProduct</span><span class="p">(</span> <span class="n">that</span> <span class="p">)</span>
</span><span id="__span-8-7">
</span><span id="__span-8-8">          <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">that</span><span class="p">,</span> <span class="ne">Vector3d</span> <span class="p">)</span> <span class="p">):</span>
</span><span id="__span-8-9">               <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MatrixVectorProduct</span><span class="p">(</span> <span class="n">that</span> <span class="p">)</span>
</span><span id="__span-8-10">
</span><span id="__span-8-11">          <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">that</span><span class="p">,</span> <span class="n">Mat4</span> <span class="p">)</span> <span class="p">):</span>
</span><span id="__span-8-12">               <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MatrixMatrixProduct</span><span class="p">(</span> <span class="n">that</span> <span class="p">)</span>
</span><span id="__span-8-13">
</span><span id="__span-8-14">          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Unsupported Operation&#39;</span> <span class="p">)</span>
</span></code></pre></div>
<p>In Rhino, <code>Transform</code> objects implement multiplication using the standard <code>*</code> operator. Therefore, compounding transformations is performed as seen below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-9-1"><span class="sd">&quot;&quot;&quot; Constructing Matrices</span>
</span><span id="__span-9-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-9-3"><span class="n">R</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span> <span class="o">...</span> <span class="p">)</span>
</span><span id="__span-9-4"><span class="n">T</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Translation</span><span class="p">(</span> <span class="o">...</span> <span class="p">)</span>
</span><span id="__span-9-5">
</span><span id="__span-9-6"><span class="sd">&quot;&quot;&quot; Combining Matrices</span>
</span><span id="__span-9-7"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-9-8"><span class="n">RT</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">T</span> <span class="c1">#-- Translate then Rotate</span>
</span><span id="__span-9-9"><span class="n">TR</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="n">R</span> <span class="c1">#-- Rotate then Translate</span>
</span></code></pre></div>
<h2 id="translation">Translation</h2>
<p>Point and vector addition provides the mechanics for translating geometry. Using matrices, translation is encoded in the last column as seen below.</p>
<p><img alt="Vector Translation Figure" src="../../../figures/vector-add-translation.svg" /></p>
<div class="highlight"><pre><span></span><code><span id="__span-10-1"><span class="sd">&quot;&quot;&quot; Translation Matrix</span>
</span><span id="__span-10-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-10-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-10-4">    <span class="nd">@staticmethod</span>
</span><span id="__span-10-5">    <span class="k">def</span><span class="w"> </span><span class="nf">Translation</span><span class="p">(</span> <span class="n">direction</span> <span class="p">):</span>
</span><span id="__span-10-6">        <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span>
</span><span id="__span-10-7">            <span class="n">xx</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">yx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
</span><span id="__span-10-8">            <span class="n">xy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span>
</span><span id="__span-10-9">            <span class="n">xz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="__span-10-10">            <span class="n">xw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="p">)</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For translation matrices, the matrix-point multiplication simplifies as seen below. As expected translation is just point-vector addition.</p>
<div class="highlight"><pre><span></span><code><span id="__span-11-1"><span class="sd">&quot;&quot;&quot; Translation Matrix x Point</span>
</span><span id="__span-11-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-11-3"><span class="n">p</span> <span class="o">=</span>  <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-11-4"><span class="n">T</span> <span class="o">=</span> <span class="n">Mat4</span><span class="o">.</span><span class="n">Translation</span><span class="p">(</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">tz</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-11-5">
</span><span id="__span-11-6"><span class="n">q</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="c1">#-- q = T * p</span>
</span><span id="__span-11-7">     <span class="mf">1.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">pz</span> <span class="o">+</span> <span class="n">tx</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="__span-11-8">     <span class="mf">0.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">pz</span> <span class="o">+</span> <span class="n">ty</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="__span-11-9">     <span class="mf">0.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">pz</span> <span class="o">+</span> <span class="n">tz</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="p">)</span>
</span><span id="__span-11-10">
</span><span id="__span-11-11"><span class="n">q</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span> <span class="o">+</span> <span class="n">tx</span><span class="p">,</span> <span class="n">py</span> <span class="o">+</span> <span class="n">ty</span><span class="p">,</span> <span class="n">pz</span> <span class="o">+</span> <span class="n">tz</span> <span class="p">)</span>
</span></code></pre></div>
</div>
<p>In Rhino the method <code>Translation( )</code> is used for constructing translation matrices as seen below. Its parameters may be either the translation vector itself or its three components.</p>
<div class="highlight"><pre><span></span><code><span id="__span-12-1"><span class="sd">&quot;&quot;&quot; Translation Vector</span>
</span><span id="__span-12-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-12-3"><span class="n">t</span> <span class="o">=</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">tz</span> <span class="p">)</span>
</span><span id="__span-12-4">
</span><span id="__span-12-5"><span class="sd">&quot;&quot;&quot; Translation Matrix</span>
</span><span id="__span-12-6"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-12-7"><span class="n">T</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Translation</span><span class="p">(</span> <span class="n">t</span> <span class="p">)</span>
</span><span id="__span-12-8"><span class="c1">#-- equivalent</span>
</span><span id="__span-12-9"><span class="n">T</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Translation</span><span class="p">(</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">tz</span> <span class="p">)</span>
</span></code></pre></div>
<h2 id="scaling">Scaling</h2>
<p>Point and vector multiplication by a scalar captures the notion of geometric scaling. In matrix form this is represented by its diagonal.</p>
<p><img alt="Vector Scaling Figure" src="../../../figures/vector-mul.svg" /></p>
<h3 id="uniform">Uniform</h3>
<p>Uniform scaling stretches or shrinks all directions by the same amount. Therefore, the same value is used for all diagonal elements of the matrix as seen below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-13-1"><span class="sd">&quot;&quot;&quot; Uniform Scaling Matrix</span>
</span><span id="__span-13-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-13-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-13-4">    <span class="nd">@staticmethod</span>
</span><span id="__span-13-5">    <span class="k">def</span><span class="w"> </span><span class="nf">ScaleUniform</span><span class="p">(</span> <span class="n">s</span> <span class="p">):</span> <span class="c1">#-- s : float</span>
</span><span id="__span-13-6">        <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span>
</span><span id="__span-13-7">            <span class="n">xx</span> <span class="o">=</span>   <span class="n">s</span><span class="p">,</span> <span class="n">yx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-13-8">            <span class="n">xy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span>   <span class="n">s</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-13-9">            <span class="n">xz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span>   <span class="n">s</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-13-10">            <span class="n">xw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="p">)</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For scaling matrices, the matrix-point and matrix-vector multiplication simplifies as seen below. As expected scaling is just point-scalar and vector-scalar multiplication.</p>
<div class="highlight"><pre><span></span><code><span id="__span-14-1"><span class="sd">&quot;&quot;&quot; Scaling Matrix x Point</span>
</span><span id="__span-14-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-14-3"><span class="n">q</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span>
</span><span id="__span-14-4">       <span class="n">s</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">pz</span><span class="p">,</span>
</span><span id="__span-14-5">     <span class="mf">0.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span>   <span class="n">s</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">pz</span><span class="p">,</span>
</span><span id="__span-14-6">     <span class="mf">0.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span>   <span class="n">s</span> <span class="o">*</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-14-7">
</span><span id="__span-14-8"><span class="n">q</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">py</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="n">pz</span> <span class="o">*</span> <span class="n">s</span> <span class="p">)</span>
</span></code></pre></div>
</div>
<p>Rhino provides several variations for constructing scaling transforms including with or without an origin. Note that scaling about an origin, or anchor point, combines translation and scaling.</p>
<div class="highlight"><pre><span></span><code><span id="__span-15-1"><span class="sd">&quot;&quot;&quot; Uniform Scaling Factor</span>
</span><span id="__span-15-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-15-3"><span class="n">s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">factor</span> <span class="p">)</span>
</span><span id="__span-15-4">
</span><span id="__span-15-5"><span class="sd">&quot;&quot;&quot; Uniform Scaling Matrix about [0.0, 0.0, 0.0]</span>
</span><span id="__span-15-6"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-15-7"><span class="n">S</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span> <span class="ne">Point3d</span><span class="o">.</span><span class="n">Origin</span><span class="p">,</span> <span class="n">s</span> <span class="p">)</span>
</span><span id="__span-15-8">
</span><span id="__span-15-9"><span class="sd">&quot;&quot;&quot; Uniform Scaling Origin</span>
</span><span id="__span-15-10"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-15-11"><span class="n">o</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">oz</span> <span class="p">)</span>
</span><span id="__span-15-12">
</span><span id="__span-15-13"><span class="sd">&quot;&quot;&quot; Uniform Scaling Matrix about Origin</span>
</span><span id="__span-15-14"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-15-15"><span class="n">S</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span> <span class="p">)</span>
</span></code></pre></div>
<h3 id="non-uniform">Non-Uniform</h3>
<p>Non-uniform scaling stretches or shrinks each direction by a different amount. Effectively, each diagonal element of the transformation matrix has a separate value as seen below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-16-1"><span class="sd">&quot;&quot;&quot; Non-Uniform Scaling Matrix</span>
</span><span id="__span-16-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-16-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-16-4">    <span class="nd">@staticmethod</span>
</span><span id="__span-16-5">    <span class="k">def</span><span class="w"> </span><span class="nf">ScaleNonUniform</span><span class="p">(</span> <span class="n">s</span> <span class="p">):</span> <span class="c1">#-- s : Vector3d</span>
</span><span id="__span-16-6">        <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span>
</span><span id="__span-16-7">            <span class="n">xx</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">yx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-16-8">            <span class="n">xy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-16-9">            <span class="n">xz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-16-10">            <span class="n">xw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">yw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">zw</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="p">)</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For scaling matrices, the matrix-point and matrix-vector multiplication simplifies as seen below. As expected scaling is just point-scalar and vector-scalar multiplication but with different factors for each.</p>
<div class="highlight"><pre><span></span><code><span id="__span-17-1"><span class="sd">&quot;&quot;&quot; Scaling Matrix x Point</span>
</span><span id="__span-17-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-17-3"><span class="n">q</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span>
</span><span id="__span-17-4">     <span class="n">s</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">pz</span><span class="p">,</span>
</span><span id="__span-17-5">     <span class="mf">0.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">pz</span><span class="p">,</span>
</span><span id="__span-17-6">     <span class="mf">0.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-17-7">
</span><span id="__span-17-8"><span class="n">q</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">py</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">pz</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span></code></pre></div>
</div>
<p>In Rhino the <code>Scale( )</code> method supports non-uniform scaling with or without an origin. The origin in this scenario is expressed as a plane for flexibility. To construct a non-uniform matrix without an origin, the WorldXY plane can be used as seen below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-18-1"><span class="sd">&quot;&quot;&quot; Non-Uniform Scaling Factors</span>
</span><span id="__span-18-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-18-3"><span class="n">s</span> <span class="o">=</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="p">)</span>
</span><span id="__span-18-4">
</span><span id="__span-18-5"><span class="sd">&quot;&quot;&quot; Non-Uniform Scaling Matrix about [0.0, 0.0, 0.0]</span>
</span><span id="__span-18-6"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-18-7"><span class="n">S</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span> <span class="ne">Plane</span><span class="o">.</span><span class="n">WorldXY</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span><span id="__span-18-8">
</span><span id="__span-18-9"><span class="sd">&quot;&quot;&quot; Non-Uniform Scaling Origin</span>
</span><span id="__span-18-10"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-18-11"><span class="n">o</span> <span class="o">=</span> <span class="ne">Plane</span><span class="p">(</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">oz</span> <span class="p">),</span>
</span><span id="__span-18-12">    <span class="ne">Vector3d</span><span class="o">.</span><span class="n">XAxis</span><span class="p">,</span> <span class="ne">Vector3d</span><span class="o">.</span><span class="n">YAxis</span> <span class="p">)</span>
</span><span id="__span-18-13">
</span><span id="__span-18-14"><span class="sd">&quot;&quot;&quot; Non-Uniform Scaling Matrix about Origin</span>
</span><span id="__span-18-15"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-18-16"><span class="n">S</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span> <span class="n">o</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span></code></pre></div>
<h2 id="reflection">Reflection</h2>
<p>Reflection or mirror transform is conceptually performed about a reference direction or plane. The matrix below represents pure reflection about a plane with unit normal <code>n = [nx, ny, nz]</code> and origin at <code>[0.0, 0.0, 0.0]</code>. Reflecting a point <code>p</code> is constructed by computing the projection of the vector <code>p - o</code> onto the normal <code>d = n · ( p - o )</code> and then moving back from <code>p</code> twice the distance to <code>q</code>, that is <code>q = p - 2 * n · ( p - o ) · n</code>.</p>
<p><img alt="Transform Reflection Figure" src="../../../figures/xform-reflect.svg" /></p>
<div class="highlight"><pre><span></span><code><span id="__span-19-1"><span class="sd">&quot;&quot;&quot; Reflection Matrix</span>
</span><span id="__span-19-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-19-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-19-4">     <span class="nd">@staticmethod</span>
</span><span id="__span-19-5">     <span class="k">def</span><span class="w"> </span><span class="nf">Reflection</span><span class="p">(</span> <span class="n">normal</span> <span class="p">):</span>
</span><span id="__span-19-6">          <span class="n">xx</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="mf">2.0</span>
</span><span id="__span-19-7">          <span class="n">xy</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="mf">2.0</span>
</span><span id="__span-19-8">          <span class="n">xz</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="mf">2.0</span>
</span><span id="__span-19-9">          <span class="n">yy</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="mf">2.0</span>
</span><span id="__span-19-10">          <span class="n">yz</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="mf">2.0</span>
</span><span id="__span-19-11">          <span class="n">zz</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="mf">2.0</span>
</span><span id="__span-19-12">
</span><span id="__span-19-13">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">-</span> <span class="n">xy</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">-</span> <span class="n">xz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-19-14">                       <span class="mf">0.0</span> <span class="o">-</span> <span class="n">xy</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">yy</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">-</span> <span class="n">yz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-19-15">                       <span class="mf">0.0</span> <span class="o">-</span> <span class="n">xz</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">-</span> <span class="n">yz</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">zz</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-19-16">                       <span class="mf">0.0</span><span class="p">,</span>      <span class="mf">0.0</span><span class="p">,</span>      <span class="mf">0.0</span><span class="p">,</span>      <span class="mf">1.0</span> <span class="p">)</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For reflection matrix about the XY-plane or the Z-axis, the matrix-point multiplication simplifies as seen below. This is equivalent of changing the sign of the point's Z-coordinate.</p>
<div class="highlight"><pre><span></span><code><span id="__span-20-1"><span class="sd">&quot;&quot;&quot; Reflection XY Matrix x Point</span>
</span><span id="__span-20-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-20-3"><span class="n">XY</span> <span class="o">=</span>  <span class="p">[[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
</span><span id="__span-20-4">       <span class="p">[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
</span><span id="__span-20-5">       <span class="p">[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">],</span>
</span><span id="__span-20-6">       <span class="p">[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">]]</span>
</span><span id="__span-20-7">
</span><span id="__span-20-8"><span class="n">xy</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span>
</span><span id="__span-20-9">     <span class="mf">1.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">pz</span><span class="p">,</span>
</span><span id="__span-20-10">     <span class="mf">0.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">pz</span><span class="p">,</span>
</span><span id="__span-20-11">     <span class="mf">0.0</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">py</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-20-12">
</span><span id="__span-20-13"><span class="n">q</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="o">-</span><span class="n">pz</span> <span class="p">)</span>
</span></code></pre></div>
</div>
<p>In Rhino the <code>Mirror( )</code> method supports reflection about a plane with or without an origin. Note that reflection about an origin other than <code>[0.0, 0.0, 0.0]</code> combines translation and reflection.</p>
<div class="highlight"><pre><span></span><code><span id="__span-21-1"><span class="sd">&quot;&quot;&quot; Point and Reflection Plane</span>
</span><span id="__span-21-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-21-3"><span class="n">p</span> <span class="o">=</span>  <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-21-4"><span class="n">n</span> <span class="o">=</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span> <span class="p">)</span>
</span><span id="__span-21-5">
</span><span id="__span-21-6"><span class="sd">&quot;&quot;&quot; Reflection about [0.0, 0.0, 0.0]</span>
</span><span id="__span-21-7"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-21-8"><span class="n">M</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Mirror</span><span class="p">(</span> <span class="ne">Plane</span><span class="p">(</span> <span class="ne">Point3d</span><span class="o">.</span><span class="n">Origin</span><span class="p">,</span> <span class="n">n</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-21-9"><span class="n">q</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">p</span>
</span><span id="__span-21-10">
</span><span id="__span-21-11"><span class="sd">&quot;&quot;&quot; Reflection about Origin</span>
</span><span id="__span-21-12"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-21-13"><span class="n">o</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">oz</span> <span class="p">)</span>
</span><span id="__span-21-14"><span class="n">M</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Mirror</span><span class="p">(</span> <span class="ne">Plane</span><span class="p">(</span> <span class="n">o</span><span class="p">,</span> <span class="n">n</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-21-15"><span class="n">q</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">p</span>
</span></code></pre></div>
<h2 id="rotation">Rotation</h2>
<p>Rotation is a significantly more complex geometric transformation and there are several ways to represent and compute. Rotation matrices are represented by the upper-left 3x3 components of a 4x4 transformation matrix. A pure rotation is equivalent to three orthonormal basis vectors, one per column.</p>
<h3 id="axis-angle">Axis Angle</h3>
<p class="annotate">The most intuitive approach for performing rotations is the axis-angle representation. It requires an axis of rotation represented by a unit vector <code>axis</code> and and <code>angle</code> in radians. (1)</p>
<ol>
<li>Sometimes, these two pieces of information are packed into a single vector with the angle encoded as the vector's magnitude.</li>
</ol>
<p><img alt="Transform Rotation Axis Angle Figure" src="../../../figures/xform-axis-angle.svg" /></p>
<div class="highlight"><pre><span></span><code><span id="__span-22-1"><span class="sd">&quot;&quot;&quot; Axis and Angle Rotation</span>
</span><span id="__span-22-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-22-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-22-4">     <span class="nd">@staticmethod</span>
</span><span id="__span-22-5">     <span class="k">def</span><span class="w"> </span><span class="nf">AxisAngle</span><span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle</span> <span class="p">):</span>
</span><span id="__span-22-6">          <span class="n">sin</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">angle</span> <span class="p">)</span>
</span><span id="__span-22-7">          <span class="n">cos</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">angle</span> <span class="p">)</span>
</span><span id="__span-22-8">          <span class="n">soc</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">cos</span>
</span><span id="__span-22-9">
</span><span id="__span-22-10">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">soc</span> <span class="o">+</span> <span class="n">cos</span><span class="p">,</span>
</span><span id="__span-22-11">                       <span class="n">yx</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">soc</span> <span class="o">-</span> <span class="n">axis</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span>
</span><span id="__span-22-12">                       <span class="n">zx</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">soc</span> <span class="o">+</span> <span class="n">axis</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span>
</span><span id="__span-22-13">
</span><span id="__span-22-14">                       <span class="n">xy</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">soc</span> <span class="o">+</span> <span class="n">axis</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span>
</span><span id="__span-22-15">                       <span class="n">yy</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">soc</span> <span class="o">+</span> <span class="n">cos</span><span class="p">,</span>
</span><span id="__span-22-16">                       <span class="n">zy</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">soc</span> <span class="o">-</span> <span class="n">axis</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span>
</span><span id="__span-22-17">
</span><span id="__span-22-18">                       <span class="n">xz</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">soc</span> <span class="o">-</span> <span class="n">axis</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span>
</span><span id="__span-22-19">                       <span class="n">yz</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">soc</span> <span class="o">+</span> <span class="n">axis</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span>
</span><span id="__span-22-20">                       <span class="n">zz</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">soc</span> <span class="o">+</span> <span class="n">cos</span> <span class="p">)</span>
</span></code></pre></div>
<p>In Rhino the <code>Rotation( )</code> method supports the axis-angle representation with or without an origin of rotation. Note that using an origin produces a matrix combining translation and rotation.</p>
<div class="highlight"><pre><span></span><code><span id="__span-23-1"><span class="sd">&quot;&quot;&quot; Rotation Axis and Angle</span>
</span><span id="__span-23-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-23-3"><span class="n">axis</span>  <span class="o">=</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span> <span class="p">)</span>
</span><span id="__span-23-4"><span class="n">angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">rads</span> <span class="p">)</span>
</span><span id="__span-23-5">
</span><span id="__span-23-6"><span class="sd">&quot;&quot;&quot; Rotation Matrix about [0.0, 0.0, 0.0]</span>
</span><span id="__span-23-7"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-23-8"><span class="n">R</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="ne">Point3d</span><span class="o">.</span><span class="n">Origin</span> <span class="p">)</span>
</span><span id="__span-23-9">
</span><span id="__span-23-10"><span class="sd">&quot;&quot;&quot; Rotation Matrix about Origin</span>
</span><span id="__span-23-11"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-23-12"><span class="n">R</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">oz</span> <span class="p">)</span> <span class="p">)</span>
</span></code></pre></div>
<h3 id="euler-angles">Euler Angles</h3>
<p>Rotation can be also expressed by combining elementary rotations about the World's basis vectors <code>X</code>, <code>Y</code> and <code>Z</code>. This approach is known as the Euler-Angles rotation and requires three angles, one per axis. First the elementary rotation matrices are defined and then their product is computed as seen below.</p>
<p><img alt="Transform Rotation Euler Angles Figure" src="../../../figures/xform-euler.svg" /></p>
<div class="highlight"><pre><span></span><code><span id="__span-24-1"><span class="sd">&quot;&quot;&quot; Elementary and Euler Angles Rotation</span>
</span><span id="__span-24-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-24-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-24-4">     <span class="nd">@staticmethod</span>
</span><span id="__span-24-5">     <span class="k">def</span><span class="w"> </span><span class="nf">RotateX</span><span class="p">(</span> <span class="n">angle</span> <span class="p">):</span>
</span><span id="__span-24-6">          <span class="n">sin</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">angle</span> <span class="p">)</span>
</span><span id="__span-24-7">          <span class="n">cos</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">angle</span> <span class="p">)</span>
</span><span id="__span-24-8">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-24-9">                       <span class="mf">0.0</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span><span class="o">-</span><span class="n">sin</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-24-10">                       <span class="mf">0.0</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-24-11">                       <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">)</span>
</span><span id="__span-24-12">     <span class="nd">@staticmethod</span>
</span><span id="__span-24-13">     <span class="k">def</span><span class="w"> </span><span class="nf">RotateY</span><span class="p">(</span> <span class="n">angle</span> <span class="p">):</span>
</span><span id="__span-24-14">          <span class="n">sin</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">angle</span> <span class="p">)</span>
</span><span id="__span-24-15">          <span class="n">cos</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">angle</span> <span class="p">)</span>
</span><span id="__span-24-16">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span> <span class="n">cos</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-24-17">                       <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-24-18">                      <span class="o">-</span><span class="n">sin</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-24-19">                       <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">)</span>
</span><span id="__span-24-20">     <span class="nd">@staticmethod</span>
</span><span id="__span-24-21">     <span class="k">def</span><span class="w"> </span><span class="nf">RotateZ</span><span class="p">(</span> <span class="n">angle</span> <span class="p">):</span>
</span><span id="__span-24-22">          <span class="n">sin</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">angle</span> <span class="p">)</span>
</span><span id="__span-24-23">          <span class="n">cos</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">angle</span> <span class="p">)</span>
</span><span id="__span-24-24">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span> <span class="n">cos</span><span class="p">,</span><span class="o">-</span><span class="n">sin</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-24-25">                       <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-24-26">                       <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-24-27">                       <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">)</span>
</span><span id="__span-24-28">     <span class="nd">@staticmethod</span>
</span><span id="__span-24-29">     <span class="k">def</span><span class="w"> </span><span class="nf">RotateZYX</span><span class="p">(</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span> <span class="p">):</span>
</span><span id="__span-24-30">          <span class="k">return</span> <span class="p">(</span> <span class="n">Mat4</span><span class="o">.</span><span class="n">RotateX</span><span class="p">(</span> <span class="n">ax</span> <span class="p">)</span> <span class="o">*</span>
</span><span id="__span-24-31">                   <span class="n">Mat4</span><span class="o">.</span><span class="n">RotateY</span><span class="p">(</span> <span class="n">ay</span> <span class="p">)</span> <span class="o">*</span>
</span><span id="__span-24-32">                   <span class="n">Mat4</span><span class="o">.</span><span class="n">RotateZ</span><span class="p">(</span> <span class="n">az</span> <span class="p">)</span> <span class="p">)</span>
</span></code></pre></div>
<p>Rhino supports two common permutation of Euler-Angle rotation, namely <code>RotationZYX( )</code> and <code>RotationZYZ( )</code>.</p>
<div class="highlight"><pre><span></span><code><span id="__span-25-1"><span class="sd">&quot;&quot;&quot; Angles per Axis</span>
</span><span id="__span-25-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-25-3"><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span> <span class="o">=</span> <span class="o">...</span><span class="n">angles</span>
</span><span id="__span-25-4">
</span><span id="__span-25-5"><span class="sd">&quot;&quot;&quot; Combined Rotation Matrix</span>
</span><span id="__span-25-6"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-25-7"><span class="n">R</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">RotationZYX</span><span class="p">(</span> <span class="n">az</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">ax</span> <span class="p">)</span>
</span></code></pre></div>
<p>Euler-Angle rotation is very old-fashioned, rather counterintuitive and <a href="https://en.wikipedia.org/wiki/Gimbal_lock">degenerates</a> for certain rotation combinations. As such it is recommended to be avoided. However, because it is still used in robotics applications, it is good to be generally aware of.</p>
<h3 id="quaternions">Quaternions</h3>
<p>The modern representation for rotation is based on the concept of a unit quaternion. Quaternions are counterintuitive because they represent complex number 4D vectors which cannot be visually comprehended. Quaternions are not required for 99% of geometric constructions. However, they are presented because they are often used in game engines and robotics applications.</p>
<p>Quaternions are popular because of their properties including (a) They are compact in that they required only <code>4</code> floats, compared to <code>9</code> per rotation matrix, (b) They express only rotation, unlike matrices that conflate rotation, scaling and reflection, and (c) They combine using multiplication, which is not possible with axis-angle vectors.</p>
<p>The most sane way to approach quaternions is to: (a) Convert regular 3D vectors to quaternions, (b) Perform the rotational transformations required, (c) Convert back from quaternion space to normal 3D vector space.</p>
<h4 id="representation">Representation</h4>
<p>Quaternions are represented as <code>q = [qx, qy, qz, qw]</code>, where approximately the <code>qx</code>, <code>qy</code> and <code>qz</code> express the axis of rotation, and <code>qw</code> the angle. They behave like vectors in that they can be added, multiplied and have length. Rotations require unit-length quaternions, so unless otherwise specified, quaternions are assumed normalized.</p>
<div class="highlight"><pre><span></span><code><span id="__span-26-1"><span class="sd">&quot;&quot;&quot; Quaternion</span>
</span><span id="__span-26-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-26-3"><span class="k">class</span><span class="w"> </span><span class="nc">Quat</span><span class="p">:</span>
</span><span id="__span-26-4">     <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span> <span class="p">):</span>
</span><span id="__span-26-5">          <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="__span-26-6">          <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="__span-26-7">          <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">z</span>
</span><span id="__span-26-8">          <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">w</span>
</span><span id="__span-26-9">
</span><span id="__span-26-10">     <span class="nd">@property</span>
</span><span id="__span-26-11">     <span class="k">def</span><span class="w"> </span><span class="nf">Length</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-26-12">          <span class="k">return</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="__span-26-13">               <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
</span><span id="__span-26-14">               <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
</span><span id="__span-26-15">               <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
</span><span id="__span-26-16">               <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">**</span> <span class="mi">2</span> <span class="p">)</span>
</span><span id="__span-26-17">
</span><span id="__span-26-18">     <span class="k">def</span><span class="w"> </span><span class="nf">Normalize</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-26-19">          <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Length</span>
</span><span id="__span-26-20">          <span class="k">if</span><span class="p">(</span> <span class="n">length</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="p">):</span>
</span><span id="__span-26-21">               <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
</span><span id="__span-26-22">          <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span>
</span><span id="__span-26-23">                       <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span>
</span><span id="__span-26-24">                       <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span>
</span><span id="__span-26-25">                       <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">/</span> <span class="n">length</span> <span class="p">)</span>
</span></code></pre></div>
<h4 id="construction">Construction</h4>
<p>Vectors can be converted from and to quaternions, where for a vector <code>u = [ux, uy, uz]</code>, the associated quaternion is <code>q = [ux, uy, uz, 0.0]</code>. Additionally, there are several methods for converting between quaternions, Axis-Angle and Euler-Angles. Constructing a quaternion using an Axis-Angle representation is shown below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-27-1"><span class="k">class</span><span class="w"> </span><span class="nc">Quat</span><span class="p">:</span>
</span><span id="__span-27-2"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Vector to Quaternion</span>
</span><span id="__span-27-3"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-27-4">     <span class="nd">@statimethod</span>
</span><span id="__span-27-5">     <span class="k">def</span><span class="w"> </span><span class="nf">FromVector</span><span class="p">(</span> <span class="n">vector</span> <span class="p">):</span>
</span><span id="__span-27-6">          <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="n">vector</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
</span><span id="__span-27-7">                       <span class="n">vector</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span>
</span><span id="__span-27-8">                       <span class="n">vector</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
</span><span id="__span-27-9">
</span><span id="__span-27-10"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Quaternion from Axis-Angle</span>
</span><span id="__span-27-11"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-27-12">     <span class="nd">@staticmethod</span>
</span><span id="__span-27-13">     <span class="k">def</span><span class="w"> </span><span class="nf">FromAxisAngle</span><span class="p">(</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle</span> <span class="p">):</span>
</span><span id="__span-27-14">          <span class="n">sin</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">angle</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="p">)</span>
</span><span id="__span-27-15">          <span class="n">cos</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">angle</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="p">)</span>
</span><span id="__span-27-16">
</span><span id="__span-27-17">          <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="n">axis</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span>
</span><span id="__span-27-18">                       <span class="n">axis</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span>
</span><span id="__span-27-19">                       <span class="n">axis</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span>
</span><span id="__span-27-20">                                <span class="n">cos</span> <span class="p">)</span>
</span></code></pre></div>
<p>Rhino's <code>Quaternion</code> expressing the same construction from Axis-Angle is presented below. Note that Rhino's naming convention uses <code>q = [a, b, c, d]</code>, where <code>a = qw</code> and  <code>b</code>, <code>c</code>, and <code>d</code> map to <code>qx</code>, <code>qy</code>, and <code>qz</code>, respectively.</p>
<div class="highlight"><pre><span></span><code><span id="__span-28-1"><span class="sd">&quot;&quot;&quot; Quaternion from Axis-Angle</span>
</span><span id="__span-28-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-28-3"><span class="n">q</span> <span class="o">=</span> <span class="ne">Quaternion</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span> <span class="p">)</span>
</span></code></pre></div>
<h4 id="compound-rotations">Compound Rotations</h4>
<p>Combining rotations, expressed as quaternions, is achieved by regular multiplication. Note that quaternion multiplication is not commutative <code>u * v != v * u</code>, so the order is important.</p>
<div class="highlight"><pre><span></span><code><span id="__span-29-1"><span class="sd">&quot;&quot;&quot; Quaternion Quaternion Product</span>
</span><span id="__span-29-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-29-3"><span class="k">class</span><span class="w"> </span><span class="nc">Quat</span><span class="p">:</span>
</span><span id="__span-29-4">     <span class="k">def</span><span class="w"> </span><span class="nf">QuatQuatProduct</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">that</span> <span class="p">):</span>
</span><span id="__span-29-5">          <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-29-6">          <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">tz</span><span class="p">,</span> <span class="n">tw</span> <span class="o">=</span> <span class="n">that</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-29-7">
</span><span id="__span-29-8">          <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span>
</span><span id="__span-29-9">               <span class="n">sw</span> <span class="o">*</span> <span class="n">tx</span> <span class="o">+</span>   <span class="n">sx</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">+</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">tz</span> <span class="o">-</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">ty</span>
</span><span id="__span-29-10">               <span class="n">sw</span> <span class="o">*</span> <span class="n">ty</span> <span class="o">+</span>   <span class="n">sy</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">tx</span> <span class="o">-</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">tz</span>
</span><span id="__span-29-11">               <span class="n">sw</span> <span class="o">*</span> <span class="n">tz</span> <span class="o">+</span>   <span class="n">sz</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">+</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">ty</span> <span class="o">-</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">tx</span>
</span><span id="__span-29-12">               <span class="n">sw</span> <span class="o">*</span> <span class="n">tw</span> <span class="o">-</span> <span class="p">(</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">tx</span> <span class="o">+</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">ty</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">tz</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-29-13">
</span><span id="__span-29-14">     <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">that</span> <span class="p">):</span>
</span><span id="__span-29-15">          <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">that</span><span class="p">,</span> <span class="n">Quat</span> <span class="p">)</span> <span class="p">):</span>
</span><span id="__span-29-16">               <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuatQuatProduct</span><span class="p">(</span> <span class="n">that</span> <span class="p">)</span>
</span><span id="__span-29-17">
</span><span id="__span-29-18">          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s1">&#39;Unsupported Operation&#39;</span> <span class="p">)</span>
</span><span id="__span-29-19">
</span><span id="__span-29-20"><span class="sd">&quot;&quot;&quot; Combined Rotation</span>
</span><span id="__span-29-21"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-29-22"><span class="n">u</span> <span class="o">=</span> <span class="n">Quat</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span> <span class="p">),</span> <span class="n">ua</span> <span class="p">)</span>
</span><span id="__span-29-23"><span class="n">v</span> <span class="o">=</span> <span class="n">Quat</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span> <span class="p">),</span> <span class="n">ub</span> <span class="p">)</span>
</span><span id="__span-29-24"><span class="n">w</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span> <span class="n">v</span>
</span></code></pre></div>
<h4 id="quaternion-to-matrix">Quaternion To Matrix</h4>
<p>Rotating points and vectors using unit quaternions can be achieved in several ways. One approach is to convert the quaternion to a 4x4 matrix and perform the transformation as usual.</p>
<div class="highlight"><pre><span></span><code><span id="__span-30-1"><span class="sd">&quot;&quot;&quot; Quaternion to Transformation Matrix</span>
</span><span id="__span-30-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-30-3"><span class="k">class</span><span class="w"> </span><span class="nc">Quat</span><span class="p">:</span>
</span><span id="__span-30-4">     <span class="k">def</span><span class="w"> </span><span class="nf">ToMatrix</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-30-5">          <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-30-6">
</span><span id="__span-30-7">          <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span>
</span><span id="__span-30-8">          <span class="n">xy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span>
</span><span id="__span-30-9">          <span class="n">xw</span><span class="p">,</span> <span class="n">yw</span><span class="p">,</span> <span class="n">zw</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">w</span><span class="p">,</span> <span class="n">z</span> <span class="o">*</span> <span class="n">w</span>
</span><span id="__span-30-10">
</span><span id="__span-30-11">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">yy</span> <span class="o">+</span> <span class="n">zz</span> <span class="p">),</span>
</span><span id="__span-30-12">                             <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xy</span> <span class="o">-</span> <span class="n">zw</span> <span class="p">),</span>
</span><span id="__span-30-13">                             <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">zx</span> <span class="o">+</span> <span class="n">yw</span> <span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-30-14">
</span><span id="__span-30-15">                             <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xy</span> <span class="o">+</span> <span class="n">zw</span> <span class="p">),</span>
</span><span id="__span-30-16">                       <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xx</span> <span class="o">+</span> <span class="n">zz</span> <span class="p">),</span>
</span><span id="__span-30-17">                             <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">yz</span> <span class="o">-</span> <span class="n">xw</span> <span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-30-18">
</span><span id="__span-30-19">                             <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">zx</span> <span class="o">-</span> <span class="n">yw</span> <span class="p">),</span>
</span><span id="__span-30-20">                             <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">yz</span> <span class="o">+</span> <span class="n">xw</span> <span class="p">),</span>
</span><span id="__span-30-21">                       <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xx</span> <span class="o">+</span> <span class="n">yy</span> <span class="p">),</span> <span class="mf">0.0</span> <span class="p">)</span>
</span><span id="__span-30-22">
</span><span id="__span-30-23"><span class="sd">&quot;&quot;&quot; Point Rotation</span>
</span><span id="__span-30-24"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-30-25"><span class="n">p</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-30-26"><span class="n">u</span> <span class="o">=</span> <span class="n">Quat</span><span class="o">.</span><span class="n">FromAxisAngle</span><span class="p">(</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span> <span class="p">),</span> <span class="n">ua</span> <span class="p">)</span>
</span><span id="__span-30-27"><span class="n">q</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">ToMatrix</span><span class="p">(</span> <span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
</span></code></pre></div>
<p>The equivalent in Rhino uses the <code>GetRotation( )</code> method which returns the transformation matrix, as seen below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-31-1"><span class="sd">&quot;&quot;&quot; Point Rotation</span>
</span><span id="__span-31-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-31-3"><span class="n">p</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-31-4"><span class="n">u</span> <span class="o">=</span> <span class="ne">Quaternion</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span> <span class="n">ua</span><span class="p">,</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-31-5"><span class="n">q</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">GetRotation</span><span class="p">(</span> <span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
</span></code></pre></div>
<h4 id="quaternion-sandwich-product">Quaternion Sandwich Product</h4>
<p>The same rotational operation can be achieved using the quaternion product <code>q' * u * q</code>, where <code>q  = [qx, qy, qz, qw]</code> is the rotation quaternion, <code>q' = [-qx, -qy, -qz, qw]</code> is its conjugate, in the complex number sense, and <code>u = [ux, uy, uz]</code> is a vector converted to a quaternion.</p>
<div class="highlight"><pre><span></span><code><span id="__span-32-1"><span class="k">class</span><span class="w"> </span><span class="nc">Quat</span><span class="p">:</span>
</span><span id="__span-32-2">     <span class="nd">@property</span>
</span><span id="__span-32-3">     <span class="k">def</span><span class="w"> </span><span class="nf">Conjugate</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-32-4">          <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
</span><span id="__span-32-5">                       <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span>
</span><span id="__span-32-6">                       <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="__span-32-7">                        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="p">)</span>
</span><span id="__span-32-8">
</span><span id="__span-32-9">     <span class="nd">@property</span>
</span><span id="__span-32-10">     <span class="k">def</span><span class="w"> </span><span class="nf">Inverse</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-32-11">          <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Length</span>
</span><span id="__span-32-12">          <span class="k">if</span><span class="p">(</span> <span class="n">length</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="p">):</span>
</span><span id="__span-32-13">               <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">,</span><span class="mf">0.0</span> <span class="p">)</span>
</span><span id="__span-32-14">          <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span>
</span><span id="__span-32-15">               <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span>
</span><span id="__span-32-16">               <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span>
</span><span id="__span-32-17">               <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span>
</span><span id="__span-32-18">               <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">/-</span><span class="n">length</span> <span class="p">)</span>
</span><span id="__span-32-19">
</span><span id="__span-32-20">     <span class="k">def</span><span class="w"> </span><span class="nf">RotateVector</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">u</span> <span class="p">):</span>
</span><span id="__span-32-21">          <span class="k">return</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Conjugate</span> <span class="o">*</span>
</span><span id="__span-32-22">                   <span class="n">Quat</span><span class="o">.</span><span class="n">FromVector</span><span class="p">(</span> <span class="n">u</span> <span class="p">)</span> <span class="o">*</span>
</span><span id="__span-32-23">                   <span class="bp">self</span> <span class="p">)</span>
</span><span id="__span-32-24">
</span><span id="__span-32-25"><span class="sd">&quot;&quot;&quot; Point and Rotation</span>
</span><span id="__span-32-26"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-32-27"><span class="n">u</span> <span class="o">=</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span> <span class="p">)</span>
</span><span id="__span-32-28"><span class="n">q</span> <span class="o">=</span> <span class="n">Quat</span><span class="o">.</span><span class="n">FromAxisAngle</span><span class="p">(</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span> <span class="p">),</span> <span class="n">angle</span> <span class="p">)</span>
</span><span id="__span-32-29"><span class="n">v</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">RotateVector</span><span class="p">(</span> <span class="n">u</span> <span class="p">)</span>
</span></code></pre></div>
<p>Note that quaternion rotation only makes sense for vectors. It can work with points if they are assumed in reference to the world. Otherwise, points must be first mapped to the world basis, then rotated using quaternions, and finally mapped back to their local basis.</p>
<p>Rhino provides the <code>Rotate( )</code> method with the same semantics as above.</p>
<div class="highlight"><pre><span></span><code><span id="__span-33-1"><span class="sd">&quot;&quot;&quot; Point and Rotation</span>
</span><span id="__span-33-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-33-3"><span class="n">u</span> <span class="o">=</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span> <span class="p">)</span>
</span><span id="__span-33-4"><span class="n">q</span> <span class="o">=</span> <span class="ne">Quaternion</span><span class="o">.</span><span class="n">Rotation</span><span class="p">(</span> <span class="n">angle</span><span class="p">,</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-33-5"><span class="n">v</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span> <span class="n">u</span> <span class="p">)</span>
</span></code></pre></div>
<h4 id="interpolation-of-rotations">Interpolation of Rotations</h4>
<p>Interpolating rotations using quaternions is one of their earliest applications that motivated their use. This is because interpolating both between transformation matrices and axis-angle vectors, element-wise, produces unreasonable results. On the other hand, quaternion interpolation rotates all three basis vectors of a coordinate system smoothly, with minimal twists.</p>
<p>There are a couple of versions of quaternion interpolation: Linear interpolation which is not unlike regular point and vector interpolation. Note that using linear combinations requires quaternion normalization. Additionally, there is spherical linear interpolation, which can be considered as a rotation about a major circle, that is passing through the center, of a sphere at equal angle steps.</p>
<div class="highlight"><pre><span></span><code><span id="__span-34-1"><span class="k">class</span><span class="w"> </span><span class="nc">Quat</span><span class="p">:</span>
</span><span id="__span-34-2"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Linear Interpolation</span>
</span><span id="__span-34-3"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-34-4">     <span class="k">def</span><span class="w"> </span><span class="nf">Lerp</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
</span><span id="__span-34-5">          <span class="n">quat</span> <span class="o">=</span> <span class="n">Quat</span><span class="p">(</span>
</span><span id="__span-34-6">               <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span> <span class="p">)</span> <span class="o">+</span> <span class="n">that</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
</span><span id="__span-34-7">               <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span> <span class="p">)</span> <span class="o">+</span> <span class="n">that</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
</span><span id="__span-34-8">               <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span> <span class="p">)</span> <span class="o">+</span> <span class="n">that</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
</span><span id="__span-34-9">               <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span> <span class="p">)</span> <span class="o">+</span> <span class="n">that</span><span class="o">.</span><span class="n">W</span> <span class="o">*</span> <span class="n">t</span> <span class="p">)</span>
</span><span id="__span-34-10">          <span class="k">return</span> <span class="n">quat</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span> <span class="p">)</span>
</span><span id="__span-34-11">
</span><span id="__span-34-12"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Spherical Linear Interpolation</span>
</span><span id="__span-34-13"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-34-14">     <span class="k">def</span><span class="w"> </span><span class="nf">Slerp</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">,</span> <span class="n">t</span> <span class="p">):</span>
</span><span id="__span-34-15">          <span class="n">cos</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">that</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span>
</span><span id="__span-34-16">                  <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">that</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span>
</span><span id="__span-34-17">                  <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">that</span><span class="o">.</span><span class="n">Z</span> <span class="o">+</span>
</span><span id="__span-34-18">                  <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">*</span> <span class="n">that</span><span class="o">.</span><span class="n">W</span> <span class="p">)</span>
</span><span id="__span-34-19">          <span class="n">cos</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span> <span class="n">cos</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">),</span> <span class="mi">1</span> <span class="p">)</span>
</span><span id="__span-34-20">
</span><span id="__span-34-21">          <span class="n">ang</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span> <span class="n">cos</span> <span class="p">)</span>
</span><span id="__span-34-22">          <span class="n">sin</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span> <span class="p">(</span> <span class="n">ang</span> <span class="p">)</span>
</span><span id="__span-34-23">
</span><span id="__span-34-24">          <span class="k">if</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">ang</span> <span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="p">):</span>
</span><span id="__span-34-25">               <span class="k">return</span> <span class="n">that</span>
</span><span id="__span-34-26">          <span class="n">sin</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">sin</span>
</span><span id="__span-34-27">
</span><span id="__span-34-28">          <span class="n">u</span> <span class="o">=</span> <span class="n">sin</span> <span class="o">*</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span> <span class="p">)</span> <span class="o">*</span> <span class="n">ang</span> <span class="p">)</span>
</span><span id="__span-34-29">          <span class="n">v</span> <span class="o">=</span> <span class="n">sin</span> <span class="o">*</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">t</span> <span class="o">*</span> <span class="n">ang</span> <span class="p">)</span>
</span><span id="__span-34-30">
</span><span id="__span-34-31">          <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span>
</span><span id="__span-34-32">               <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">that</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span>
</span><span id="__span-34-33">               <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">that</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span>
</span><span id="__span-34-34">               <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">that</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span>
</span><span id="__span-34-35">               <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">that</span><span class="o">.</span><span class="n">W</span> <span class="o">*</span> <span class="n">v</span> <span class="p">)</span>
</span></code></pre></div>
<h2 id="matrix-inverse">Matrix Inverse</h2>
<p>The inverse of a square matrix <em>M<sup>-1</sup></em> multiplied with the matrix itself <em>M<sup>-1</sup>M = I</em> produces the identity matrix. A matrix is invertible if its determinant is not zero. A transformation matrix constructed by compounding translation, rotation, scaling and reflection, is generally invertible. The inverse of transformation matrix has some interesting properties. Note that from the point transformation formula <em>Mp = q</em>, by multiplying both sides with the inverse produces <em>M<sup>-1</sup>Mp = M<sup>-1</sup>q</em> or <em>p = M<sup>-1</sup>q</em>.</p>
<p>The interpretation of this is that transforming a point by a matrix <em>Mp = q</em> is equivalent to local-to-global coordinates transform, while transforming a point by the inverse of the matrix <em>p = M<sup>-1</sup>q</em> produces the global-to-local mapping.</p>
<div class="highlight"><pre><span></span><code><span id="__span-35-1"><span class="sd">&quot;&quot;&quot; Matrix Inverse</span>
</span><span id="__span-35-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-35-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-35-4">     <span class="nd">@property</span>
</span><span id="__span-35-5">     <span class="k">def</span><span class="w"> </span><span class="nf">Inverse</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-35-6"><span class="w">          </span><span class="sd">&quot;&quot;&quot; Unpack Matrix Elements</span>
</span><span id="__span-35-7"><span class="sd">          &quot;&quot;&quot;</span>
</span><span id="__span-35-8">          <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span>
</span><span id="__span-35-9">          <span class="n">xy</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span>
</span><span id="__span-35-10">          <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-35-11">          <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-35-12">
</span><span id="__span-35-13"><span class="w">          </span><span class="sd">&quot;&quot;&quot; Minor Determinants</span>
</span><span id="__span-35-14"><span class="sd">          &quot;&quot;&quot;</span>
</span><span id="__span-35-15">          <span class="n">t00</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">yx</span> <span class="o">*</span> <span class="n">xy</span>
</span><span id="__span-35-16">          <span class="n">t01</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">-</span> <span class="n">zx</span> <span class="o">*</span> <span class="n">xy</span>
</span><span id="__span-35-17">          <span class="n">t02</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">wy</span> <span class="o">-</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">xy</span>
</span><span id="__span-35-18">          <span class="n">t03</span> <span class="o">=</span> <span class="n">yx</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">-</span> <span class="n">zx</span> <span class="o">*</span> <span class="n">yy</span>
</span><span id="__span-35-19">          <span class="n">t04</span> <span class="o">=</span> <span class="n">yx</span> <span class="o">*</span> <span class="n">wy</span> <span class="o">-</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">yy</span>
</span><span id="__span-35-20">          <span class="n">t05</span> <span class="o">=</span> <span class="n">zx</span> <span class="o">*</span> <span class="n">wy</span> <span class="o">-</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">zy</span>
</span><span id="__span-35-21">          <span class="n">t06</span> <span class="o">=</span> <span class="n">xz</span> <span class="o">*</span> <span class="n">yw</span> <span class="o">-</span> <span class="n">yz</span> <span class="o">*</span> <span class="n">xw</span>
</span><span id="__span-35-22">          <span class="n">t07</span> <span class="o">=</span> <span class="n">xz</span> <span class="o">*</span> <span class="n">zw</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">*</span> <span class="n">xw</span>
</span><span id="__span-35-23">          <span class="n">t08</span> <span class="o">=</span> <span class="n">xz</span> <span class="o">*</span> <span class="n">ww</span> <span class="o">-</span> <span class="n">wz</span> <span class="o">*</span> <span class="n">xw</span>
</span><span id="__span-35-24">          <span class="n">t09</span> <span class="o">=</span> <span class="n">yz</span> <span class="o">*</span> <span class="n">zw</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">*</span> <span class="n">yw</span>
</span><span id="__span-35-25">          <span class="n">t10</span> <span class="o">=</span> <span class="n">yz</span> <span class="o">*</span> <span class="n">ww</span> <span class="o">-</span> <span class="n">wz</span> <span class="o">*</span> <span class="n">yw</span>
</span><span id="__span-35-26">          <span class="n">t11</span> <span class="o">=</span> <span class="n">zz</span> <span class="o">*</span> <span class="n">ww</span> <span class="o">-</span> <span class="n">wz</span> <span class="o">*</span> <span class="n">zw</span>
</span><span id="__span-35-27">
</span><span id="__span-35-28"><span class="w">          </span><span class="sd">&quot;&quot;&quot; Determinant (unsafe)</span>
</span><span id="__span-35-29"><span class="sd">          &quot;&quot;&quot;</span>
</span><span id="__span-35-30">          <span class="n">det</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span> <span class="n">t00</span> <span class="o">*</span> <span class="n">t11</span> <span class="o">-</span> <span class="n">t01</span> <span class="o">*</span> <span class="n">t10</span> <span class="o">+</span>
</span><span id="__span-35-31">                        <span class="n">t02</span> <span class="o">*</span> <span class="n">t09</span> <span class="o">+</span> <span class="n">t03</span> <span class="o">*</span> <span class="n">t08</span> <span class="o">-</span>
</span><span id="__span-35-32">                        <span class="n">t04</span> <span class="o">*</span> <span class="n">t07</span> <span class="o">+</span> <span class="n">t05</span> <span class="o">*</span> <span class="n">t06</span> <span class="p">)</span>
</span><span id="__span-35-33">
</span><span id="__span-35-34"><span class="w">          </span><span class="sd">&quot;&quot;&quot; Matrix Inverse</span>
</span><span id="__span-35-35"><span class="sd">          &quot;&quot;&quot;</span>
</span><span id="__span-35-36">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span>
</span><span id="__span-35-37">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">t11</span> <span class="o">-</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">t10</span> <span class="o">+</span> <span class="n">wy</span> <span class="o">*</span> <span class="n">t09</span> <span class="p">),</span>
</span><span id="__span-35-38">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">zx</span> <span class="o">*</span> <span class="n">t10</span> <span class="o">-</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">t09</span> <span class="o">-</span> <span class="n">yx</span> <span class="o">*</span> <span class="n">t11</span> <span class="p">),</span>
</span><span id="__span-35-39">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">yw</span> <span class="o">*</span> <span class="n">t05</span> <span class="o">-</span> <span class="n">zw</span> <span class="o">*</span> <span class="n">t04</span> <span class="o">+</span> <span class="n">ww</span> <span class="o">*</span> <span class="n">t03</span> <span class="p">),</span>
</span><span id="__span-35-40">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">zz</span> <span class="o">*</span> <span class="n">t04</span> <span class="o">-</span> <span class="n">wz</span> <span class="o">*</span> <span class="n">t03</span> <span class="o">-</span> <span class="n">yz</span> <span class="o">*</span> <span class="n">t05</span> <span class="p">),</span>
</span><span id="__span-35-41">
</span><span id="__span-35-42">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">t08</span> <span class="o">-</span> <span class="n">wy</span> <span class="o">*</span> <span class="n">t07</span> <span class="o">-</span> <span class="n">xy</span> <span class="o">*</span> <span class="n">t11</span> <span class="p">),</span>
</span><span id="__span-35-43">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">t11</span> <span class="o">-</span> <span class="n">zx</span> <span class="o">*</span> <span class="n">t08</span> <span class="o">+</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">t07</span> <span class="p">),</span>
</span><span id="__span-35-44">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">zw</span> <span class="o">*</span> <span class="n">t02</span> <span class="o">-</span> <span class="n">ww</span> <span class="o">*</span> <span class="n">t01</span> <span class="o">-</span> <span class="n">xw</span> <span class="o">*</span> <span class="n">t05</span> <span class="p">),</span>
</span><span id="__span-35-45">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xz</span> <span class="o">*</span> <span class="n">t05</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">*</span> <span class="n">t02</span> <span class="o">+</span> <span class="n">wz</span> <span class="o">*</span> <span class="n">t01</span> <span class="p">),</span>
</span><span id="__span-35-46">
</span><span id="__span-35-47">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xy</span> <span class="o">*</span> <span class="n">t10</span> <span class="o">-</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">t08</span> <span class="o">+</span> <span class="n">wy</span> <span class="o">*</span> <span class="n">t06</span> <span class="p">),</span>
</span><span id="__span-35-48">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">yx</span> <span class="o">*</span> <span class="n">t08</span> <span class="o">-</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">t06</span> <span class="o">-</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">t10</span> <span class="p">),</span>
</span><span id="__span-35-49">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xw</span> <span class="o">*</span> <span class="n">t04</span> <span class="o">-</span> <span class="n">yw</span> <span class="o">*</span> <span class="n">t02</span> <span class="o">+</span> <span class="n">ww</span> <span class="o">*</span> <span class="n">t00</span> <span class="p">),</span>
</span><span id="__span-35-50">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">yz</span> <span class="o">*</span> <span class="n">t02</span> <span class="o">-</span> <span class="n">wz</span> <span class="o">*</span> <span class="n">t00</span> <span class="o">-</span> <span class="n">xz</span> <span class="o">*</span> <span class="n">t04</span> <span class="p">),</span>
</span><span id="__span-35-51">
</span><span id="__span-35-52">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">t07</span> <span class="o">-</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">t06</span> <span class="o">-</span> <span class="n">xy</span> <span class="o">*</span> <span class="n">t09</span> <span class="p">),</span>
</span><span id="__span-35-53">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">t09</span> <span class="o">-</span> <span class="n">yx</span> <span class="o">*</span> <span class="n">t07</span> <span class="o">+</span> <span class="n">zx</span> <span class="o">*</span> <span class="n">t06</span> <span class="p">),</span>
</span><span id="__span-35-54">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">yw</span> <span class="o">*</span> <span class="n">t01</span> <span class="o">-</span> <span class="n">zw</span> <span class="o">*</span> <span class="n">t00</span> <span class="o">-</span> <span class="n">xw</span> <span class="o">*</span> <span class="n">t03</span> <span class="p">),</span>
</span><span id="__span-35-55">               <span class="n">det</span> <span class="o">*</span> <span class="p">(</span> <span class="n">xz</span> <span class="o">*</span> <span class="n">t03</span> <span class="o">-</span> <span class="n">yz</span> <span class="o">*</span> <span class="n">t01</span> <span class="o">+</span> <span class="n">zz</span> <span class="o">*</span> <span class="n">t00</span> <span class="p">)</span> <span class="p">)</span>
</span></code></pre></div>
<p>Inverting general transformation matrices as seen above is computationally involved. However, inverting elementary transformations is much simpler: The inverse of a translation matrix is a translation matrix with the negative displacement values. The inverse of a scaling matrix is a scaling matrix with the inverse scaling factors. The inverse of a rotation matrix is its transpose.</p>
<div class="highlight"><pre><span></span><code><span id="__span-36-1"><span class="sd">&quot;&quot;&quot; Matrix Inverse</span>
</span><span id="__span-36-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-36-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-36-4">    <span class="k">def</span><span class="w"> </span><span class="nf">TranslationInverse</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-36-5">          <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span>
</span><span id="__span-36-6">          <span class="n">xy</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span>
</span><span id="__span-36-7">          <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-36-8">          <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-36-9">
</span><span id="__span-36-10">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span>
</span><span id="__span-36-11">               <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span> <span class="o">=</span> <span class="n">yx</span><span class="p">,</span> <span class="n">zx</span> <span class="o">=</span> <span class="n">zx</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="o">-</span><span class="n">wx</span><span class="p">,</span>
</span><span id="__span-36-12">               <span class="n">xy</span> <span class="o">=</span> <span class="n">xy</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="n">zy</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="o">-</span><span class="n">wy</span><span class="p">,</span>
</span><span id="__span-36-13">               <span class="n">xz</span> <span class="o">=</span> <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">zz</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="o">-</span><span class="n">wz</span><span class="p">,</span>
</span><span id="__span-36-14">               <span class="n">xw</span> <span class="o">=</span> <span class="n">xw</span><span class="p">,</span> <span class="n">yw</span> <span class="o">=</span> <span class="n">yw</span><span class="p">,</span> <span class="n">zw</span> <span class="o">=</span> <span class="n">zw</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span>  <span class="n">ww</span> <span class="p">)</span>
</span><span id="__span-36-15">
</span><span id="__span-36-16">    <span class="k">def</span><span class="w"> </span><span class="nf">ScaleUniformInverse</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-36-17">          <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span>
</span><span id="__span-36-18">          <span class="n">xy</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span>
</span><span id="__span-36-19">          <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-36-20">          <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-36-21">
</span><span id="__span-36-22">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span>
</span><span id="__span-36-23">               <span class="n">xx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span> <span class="o">=</span>     <span class="n">yx</span><span class="p">,</span> <span class="n">zx</span> <span class="o">=</span>     <span class="n">zx</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="n">wx</span><span class="p">,</span>
</span><span id="__span-36-24">               <span class="n">xy</span> <span class="o">=</span>     <span class="n">xy</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span>     <span class="n">zy</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="n">wy</span><span class="p">,</span>
</span><span id="__span-36-25">               <span class="n">xz</span> <span class="o">=</span>     <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span>     <span class="n">yz</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">zz</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="n">wz</span><span class="p">,</span>
</span><span id="__span-36-26">               <span class="n">xw</span> <span class="o">=</span>     <span class="n">xw</span><span class="p">,</span> <span class="n">yw</span> <span class="o">=</span>     <span class="n">yw</span><span class="p">,</span> <span class="n">zw</span> <span class="o">=</span>     <span class="n">zw</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span> <span class="p">)</span>
</span><span id="__span-36-27">
</span><span id="__span-36-28">     <span class="k">def</span><span class="w"> </span><span class="nf">RotationInverse</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-36-29">          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Transpose</span>
</span><span id="__span-36-30">
</span><span id="__span-36-31">     <span class="nd">@property</span>
</span><span id="__span-36-32">     <span class="k">def</span><span class="w"> </span><span class="nf">Transpose</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
</span><span id="__span-36-33">          <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span>
</span><span id="__span-36-34">          <span class="n">xy</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span>
</span><span id="__span-36-35">          <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-36-36">          <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-36-37">
</span><span id="__span-36-38">          <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span>
</span><span id="__span-36-39">               <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span> <span class="o">=</span> <span class="n">xy</span><span class="p">,</span> <span class="n">zx</span> <span class="o">=</span> <span class="n">xz</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="n">xw</span><span class="p">,</span>
</span><span id="__span-36-40">               <span class="n">xy</span> <span class="o">=</span> <span class="n">yx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="n">yz</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="n">yw</span><span class="p">,</span>
</span><span id="__span-36-41">               <span class="n">xz</span> <span class="o">=</span> <span class="n">zx</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="n">zy</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">zz</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="n">zw</span><span class="p">,</span>
</span><span id="__span-36-42">               <span class="n">xw</span> <span class="o">=</span> <span class="n">wx</span><span class="p">,</span> <span class="n">yw</span> <span class="o">=</span> <span class="n">wy</span><span class="p">,</span> <span class="n">zw</span> <span class="o">=</span> <span class="n">wz</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span> <span class="p">)</span>
</span></code></pre></div>
<p>Therefore, a transformation M = T * S * R, composed of translation <code>T</code>, scaling <code>S</code> and rotation <code>R</code>, can be inverted using M<sup>-1</sup> = R<sup>T</sup> * S<sup>-1</sup> * T<sup>-1</sup>, because M<sup>-1</sup> * M =  R<sup>T</sup> * S<sup>-1</sup> * ( T<sup>-1</sup> * T ) * S * R, and thus M<sup>-1</sup> * M =  R<sup>T</sup> * ( S<sup>-1</sup> * S ) * R which yields M<sup>-1</sup> * M = R<sup>T</sup> * R = I, which just the identity matrix.</p>
<p>Moreover, for orthonormal matrices, there is no scaling component, therefore M<sup>-1</sup> = R<sup>T</sup> * T<sup>-1</sup> which can be expanded as seen below. This computation is much simpler and  matches the process of <a href="../systems/#world-to-local">world-to-local mapping</a>  presented earlier, where the dot products of between the translation vector and the basis vectors were computed.</p>
<div class="highlight"><pre><span></span><code><span id="__span-37-1"><span class="sd">&quot;&quot;&quot; Inverse of Basis Matrix</span>
</span><span id="__span-37-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-37-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-37-4">    <span class="nd">@property</span>
</span><span id="__span-37-5">    <span class="k">def</span><span class="w"> </span><span class="nf">Reverse</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-37-6">        <span class="n">xx</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">wx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span>
</span><span id="__span-37-7">        <span class="n">xy</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">wy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span>
</span><span id="__span-37-8">        <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">wz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-37-9">        <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">W</span>
</span><span id="__span-37-10">
</span><span id="__span-37-11">        <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span>
</span><span id="__span-37-12">          <span class="n">xx</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">xz</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">xx</span> <span class="o">+</span> <span class="n">wy</span> <span class="o">*</span> <span class="n">xy</span> <span class="o">+</span> <span class="n">wz</span> <span class="o">*</span> <span class="n">xz</span> <span class="p">),</span>
</span><span id="__span-37-13">          <span class="n">yx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">yx</span> <span class="o">+</span> <span class="n">wy</span> <span class="o">*</span> <span class="n">yy</span> <span class="o">+</span> <span class="n">wz</span> <span class="o">*</span> <span class="n">yz</span> <span class="p">),</span>
</span><span id="__span-37-14">          <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span> <span class="n">wx</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">+</span> <span class="n">wy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">+</span> <span class="n">wz</span> <span class="o">*</span> <span class="n">zz</span> <span class="p">)</span> <span class="p">)</span>
</span></code></pre></div>
<h2 id="basis-to-basis">Basis to Basis</h2>
<p>Transforming geometries in a rigid way between coordinate systems was discussed earlier using the concept of <a href="../systems/#basis-to-basis">basis-to-basis mapping</a>. This operation can be performed using matrices. Since a matrix and its inverse encompass the change from local-to-global coordinates it is just a matter of composing two transformations, namely the inverse of the source basis followed by the target basis transform.</p>
<p><img alt="Basis to Basis Figure" src="../../../figures/vector-basis-change.svg" /></p>
<div class="highlight"><pre><span></span><code><span id="__span-38-1"><span class="sd">&quot;&quot;&quot; Basis to Basis Transform</span>
</span><span id="__span-38-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-38-3"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-38-4">     <span class="k">def</span><span class="w"> </span><span class="nf">BasisToBasis</span><span class="p">(</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="p">):</span>
</span><span id="__span-38-5">          <span class="k">return</span> <span class="n">target</span> <span class="o">*</span> <span class="n">source</span><span class="o">.</span><span class="n">Reverse</span>
</span><span id="__span-38-6">
</span><span id="__span-38-7"><span class="sd">&quot;&quot;&quot; World to Source</span>
</span><span id="__span-38-8"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-38-9"><span class="n">source</span> <span class="o">=</span> <span class="n">Mat4</span><span class="o">.</span><span class="n">Plane</span><span class="p">(</span>  <span class="ne">Point3d</span><span class="p">(</span> <span class="n">sox</span><span class="p">,</span> <span class="n">soy</span><span class="p">,</span> <span class="n">soz</span> <span class="p">),</span>
</span><span id="__span-38-10">                     <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">sxx</span><span class="p">,</span> <span class="n">sxy</span><span class="p">,</span> <span class="n">sxz</span> <span class="p">),</span>
</span><span id="__span-38-11">                     <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">syx</span><span class="p">,</span> <span class="n">syy</span><span class="p">,</span> <span class="n">syz</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-38-12">
</span><span id="__span-38-13"><span class="n">target</span> <span class="o">=</span> <span class="n">Mat4</span><span class="o">.</span><span class="n">Plane</span><span class="p">(</span>  <span class="ne">Point3d</span><span class="p">(</span> <span class="n">tox</span><span class="p">,</span> <span class="n">toy</span><span class="p">,</span> <span class="n">toz</span> <span class="p">),</span>
</span><span id="__span-38-14">                     <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">txx</span><span class="p">,</span> <span class="n">txy</span><span class="p">,</span> <span class="n">txz</span> <span class="p">),</span>
</span><span id="__span-38-15">                     <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">tyx</span><span class="p">,</span> <span class="n">tyy</span><span class="p">,</span> <span class="n">tyz</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-38-16">
</span><span id="__span-38-17"><span class="n">transform</span> <span class="o">=</span> <span class="n">Mat4</span><span class="o">.</span><span class="n">BasisToBasis</span><span class="p">(</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="p">)</span>
</span><span id="__span-38-18">
</span><span id="__span-38-19"><span class="n">point</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-38-20"><span class="n">point</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span> <span class="n">transform</span> <span class="p">)</span>
</span></code></pre></div>
<p>Rhino provides the <code>PlaneToPlane( )</code> method for constructing such transforms, where the first parameter is a source plane and the second parameter is the target plane. Note that mapping from world-to-local space can be performed using <code>PlaneToPlane( source, Plane.WorldXY )</code> and local-to-world using <code>PlaneToPlane( Plane.WorldXY, target )</code>. In that sense plane-to-plane is just a composition of these two transformations.</p>
<div class="highlight"><pre><span></span><code><span id="__span-39-1"><span class="sd">&quot;&quot;&quot; Plane to Plane Transform</span>
</span><span id="__span-39-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-39-3"><span class="n">source</span> <span class="o">=</span> <span class="ne">Plane</span><span class="p">(</span>  <span class="ne">Point3d</span><span class="p">(</span> <span class="n">sox</span><span class="p">,</span> <span class="n">soy</span><span class="p">,</span> <span class="n">soz</span> <span class="p">),</span>
</span><span id="__span-39-4">                <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">sxx</span><span class="p">,</span> <span class="n">sxy</span><span class="p">,</span> <span class="n">sxz</span> <span class="p">),</span>
</span><span id="__span-39-5">                <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">syx</span><span class="p">,</span> <span class="n">syy</span><span class="p">,</span> <span class="n">syz</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-39-6">
</span><span id="__span-39-7"><span class="n">target</span> <span class="o">=</span> <span class="ne">Plane</span><span class="p">(</span>  <span class="ne">Point3d</span><span class="p">(</span> <span class="n">tox</span><span class="p">,</span> <span class="n">toy</span><span class="p">,</span> <span class="n">toz</span> <span class="p">),</span>
</span><span id="__span-39-8">                <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">txx</span><span class="p">,</span> <span class="n">txy</span><span class="p">,</span> <span class="n">txz</span> <span class="p">),</span>
</span><span id="__span-39-9">                <span class="ne">Vector3d</span><span class="p">(</span> <span class="n">tyx</span><span class="p">,</span> <span class="n">tyy</span><span class="p">,</span> <span class="n">tyz</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-39-10">
</span><span id="__span-39-11"><span class="n">transform</span> <span class="o">=</span> <span class="ne">Transform</span><span class="o">.</span><span class="n">PlaneToPlane</span><span class="p">(</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="p">)</span>
</span><span id="__span-39-12">
</span><span id="__span-39-13"><span class="n">point</span> <span class="o">=</span> <span class="ne">Point3d</span><span class="p">(</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span> <span class="p">)</span>
</span><span id="__span-39-14"><span class="n">point</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span> <span class="n">transform</span> <span class="p">)</span>
</span></code></pre></div>
<h2 id="conversions">Conversions</h2>
<p>With so many representations of rotation it is often required to convert between one another. This section provides some common conversions which are mainly presented because of their use in robotics. Quaternion to axis-angle conversion is straight forward as seen below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-40-1"><span class="sd">&quot;&quot;&quot; Quaternion to Axis Angle</span>
</span><span id="__span-40-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-40-3"><span class="k">class</span><span class="w"> </span><span class="nc">Quat</span><span class="p">:</span>
</span><span id="__span-40-4">     <span class="k">def</span><span class="w"> </span><span class="nf">ToAxisAngle</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-40-5">          <span class="n">length</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
</span><span id="__span-40-6">                              <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
</span><span id="__span-40-7">                              <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">2</span> <span class="p">)</span>
</span><span id="__span-40-8">          <span class="k">if</span><span class="p">(</span> <span class="n">length</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="p">):</span>
</span><span id="__span-40-9">               <span class="k">return</span> <span class="p">(</span> <span class="ne">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
</span><span id="__span-40-10">
</span><span id="__span-40-11">          <span class="n">angle</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="p">)</span>
</span><span id="__span-40-12">          <span class="k">return</span> <span class="p">(</span> <span class="ne">Vector3d</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">/</span> <span class="n">scale</span><span class="p">,</span>
</span><span id="__span-40-13">                             <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">/</span> <span class="n">scale</span><span class="p">,</span>
</span><span id="__span-40-14">                             <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">/</span> <span class="n">scale</span> <span class="p">),</span> <span class="n">angle</span> <span class="p">)</span>
</span></code></pre></div>
<p>Matrix to quaternion conversion is not a straight forward with several implementations available. UR robots use Java's conversion, see relevant <a href="https://github.com/hharrison/vecmath/tree/master">repository</a> on github.</p>
<div class="highlight"><pre><span></span><code><span id="__span-41-1"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-41-2"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Mat4 to Quat for UR</span>
</span><span id="__span-41-3"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-41-4">     <span class="k">def</span><span class="w"> </span><span class="nf">ToQuatUR</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-41-5">          <span class="n">ww</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span>
</span><span id="__span-41-6">                        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span>
</span><span id="__span-41-7">                        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span>
</span><span id="__span-41-8">          <span class="k">if</span><span class="p">(</span> <span class="n">ww</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">):</span>
</span><span id="__span-41-9">               <span class="k">if</span><span class="p">(</span> <span class="n">ww</span> <span class="o">&gt;=</span> <span class="mf">1e-30</span> <span class="p">):</span>
</span><span id="__span-41-10">                    <span class="n">qw</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">ww</span> <span class="p">)</span>
</span><span id="__span-41-11">                    <span class="n">ww</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">/</span> <span class="n">qw</span>
</span><span id="__span-41-12">                    <span class="n">qx</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span> <span class="p">)</span> <span class="o">*</span> <span class="n">ww</span>
</span><span id="__span-41-13">                    <span class="n">qy</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span> <span class="o">*</span> <span class="n">ww</span>
</span><span id="__span-41-14">                    <span class="n">qz</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="p">)</span> <span class="o">*</span> <span class="n">ww</span>
</span><span id="__span-41-15">                    <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qw</span> <span class="p">)</span>
</span><span id="__span-41-16">          <span class="k">else</span> <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
</span><span id="__span-41-17">
</span><span id="__span-41-18">          <span class="n">qw</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-41-19">          <span class="n">ww</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span><span id="__span-41-20">          <span class="k">if</span><span class="p">(</span> <span class="n">ww</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="p">):</span>
</span><span id="__span-41-21">               <span class="k">if</span><span class="p">(</span> <span class="n">ww</span> <span class="o">&gt;=</span> <span class="mf">1e-30</span> <span class="p">):</span>
</span><span id="__span-41-22">                    <span class="n">qx</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">ww</span> <span class="p">)</span>
</span><span id="__span-41-23">                    <span class="n">ww</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">qx</span>
</span><span id="__span-41-24">                    <span class="n">qy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">ww</span>
</span><span id="__span-41-25">                    <span class="n">qz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">ww</span>
</span><span id="__span-41-26">                    <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qw</span> <span class="p">)</span>
</span><span id="__span-41-27">          <span class="k">else</span> <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
</span><span id="__span-41-28">
</span><span id="__span-41-29">          <span class="n">qx</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-41-30">          <span class="n">ww</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">matrix</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span><span id="__span-41-31">          <span class="k">if</span><span class="p">(</span> <span class="n">ww</span> <span class="o">&gt;=</span> <span class="mf">1e-30</span> <span class="p">):</span>
</span><span id="__span-41-32">               <span class="n">qy</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">ww</span> <span class="p">)</span>
</span><span id="__span-41-33">               <span class="n">qz</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span> <span class="o">/</span> <span class="n">qy</span> <span class="p">)</span>
</span><span id="__span-41-34">               <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
</span><span id="__span-41-35">          <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
</span></code></pre></div>
<p>The matrix to quaternion conversion used by ABB robots is compatible with the branchless implementation, see <a href="http://www.thetenthplanet.de/archives/1994">Christian's</a> derivation of the expressions found below.</p>
<div class="highlight"><pre><span></span><code><span id="__span-42-1"><span class="k">def</span><span class="w"> </span><span class="nf">math_sign</span><span class="p">(</span> <span class="n">value</span> <span class="p">):</span>
</span><span id="__span-42-2">     <span class="k">if</span><span class="p">(</span> <span class="n">value</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="p">):</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-42-3">     <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span><span class="p">(</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-42-4">
</span><span id="__span-42-5"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-42-6"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Mat4 to Quat ABB</span>
</span><span id="__span-42-7"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-42-8">     <span class="k">def</span><span class="w"> </span><span class="nf">ToQuatABB</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-42-9">          <span class="n">x</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-42-10">                <span class="mf">1.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-42-11">                    <span class="o">*</span> <span class="n">math_sign</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-42-12">          <span class="n">y</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-42-13">                <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-42-14">                    <span class="o">*</span> <span class="n">math_sign</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-42-15">          <span class="n">z</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">math_sqrt</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-42-16">                <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-42-17">                    <span class="o">*</span> <span class="n">math_sign</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-42-18">          <span class="n">w</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-42-19">                <span class="mf">1.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-42-20">        <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span> <span class="p">)</span>
</span></code></pre></div>
<p>There is yet another implementation from <a href="https://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/">Euclidean Space</a> presented below for completeness, even though it does not seem to be compatible with either robot system.</p>
<div class="highlight"><pre><span></span><code><span id="__span-43-1"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-43-2"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Euclidean Space Mat4 to Quat</span>
</span><span id="__span-43-3"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-43-4">     <span class="k">def</span><span class="w"> </span><span class="nf">ToQuatES</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-43-5">          <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span>
</span><span id="__span-43-6">          <span class="k">if</span><span class="p">(</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="p">):</span>
</span><span id="__span-43-7">               <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
</span><span id="__span-43-8">               <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span>
</span><span id="__span-43-9">                    <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span> <span class="p">),</span>
</span><span id="__span-43-10">                    <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span> <span class="p">),</span>
</span><span id="__span-43-11">                    <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="p">),</span>
</span><span id="__span-43-12">                    <span class="mf">0.25</span> <span class="o">/</span> <span class="n">s</span> <span class="p">)</span>
</span><span id="__span-43-13">
</span><span id="__span-43-14">          <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="p">)</span> <span class="ow">and</span>
</span><span id="__span-43-15">              <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span> <span class="p">):</span>
</span><span id="__span-43-16">               <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span>
</span><span id="__span-43-17">                                        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span>
</span><span id="__span-43-18">                                        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span><span id="__span-43-19">               <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span>
</span><span id="__span-43-20">                    <span class="mf">0.25</span> <span class="o">/</span> <span class="n">s</span><span class="p">,</span>
</span><span id="__span-43-21">                    <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="p">),</span>
</span><span id="__span-43-22">                    <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span> <span class="p">),</span>
</span><span id="__span-43-23">                    <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-43-24">
</span><span id="__span-43-25">          <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">):</span>
</span><span id="__span-43-26">               <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span>
</span><span id="__span-43-27">                                        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span>
</span><span id="__span-43-28">                                        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span><span id="__span-43-29">               <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span>
</span><span id="__span-43-30">                    <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="p">),</span>
</span><span id="__span-43-31">                    <span class="mf">0.25</span> <span class="o">/</span> <span class="n">s</span><span class="p">,</span>
</span><span id="__span-43-32">                    <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span> <span class="p">),</span>
</span><span id="__span-43-33">                    <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-43-34">
</span><span id="__span-43-35">          <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span>
</span><span id="__span-43-36">                                   <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span>
</span><span id="__span-43-37">                                   <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="p">)</span>
</span><span id="__span-43-38">          <span class="k">return</span> <span class="n">Quat</span><span class="p">(</span>
</span><span id="__span-43-39">               <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span> <span class="p">),</span>
</span><span id="__span-43-40">               <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span> <span class="p">),</span>
</span><span id="__span-43-41">               <span class="mf">0.25</span> <span class="o">/</span> <span class="n">s</span><span class="p">,</span>
</span><span id="__span-43-42">               <span class="n">s</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="p">)</span> <span class="p">)</span>
</span></code></pre></div>
<p>Extracting the Euler angles from a rotation matrix is another ambiguous conversion with several implementations. KUKA robots use <code>A</code>, <code>B</code> and <code>C</code> Euler angles which map to the <code>Z</code>, <code>Y</code> and <code>X</code> axes, respectively. Additionally, the method <code>ToEulerAnglesKUKA( )</code>, when angle <code>B</code> is <code>±π/2</code>, the solution in not the inverse of <code>FromEulerKUKA( )</code> as <code>A</code> is set to <code>0</code>, see <a href="http://www.kuka-robotics.com/nr/rdonlyres/5e66a5d6-f30f-46be-b9cf-6820c55fce91/0/armtutorial2.pdf">documentation</a>.</p>
<p>Two alternative implementations are presented, the conventional <code>ToEulerAngles( )</code>, which is the inverse of <code>RotateZYX( )</code>, and a safe version proposed by Mike Day, see <a href="http://www.insomniacgames.com/mike-day-extracting-euler-angles-from-a-rotation-matrix/">derivation</a>. Note that the results are subject to sign changed based on whether the elementary matrices are considered in the clockwise or counter-clockwise sense.</p>
<div class="highlight"><pre><span></span><code><span id="__span-44-1"><span class="k">class</span><span class="w"> </span><span class="nc">Mat4</span><span class="p">:</span>
</span><span id="__span-44-2"><span class="w">     </span><span class="sd">&quot;&quot;&quot; KUKA Compatible Euler Rotation</span>
</span><span id="__span-44-3"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-44-4">     <span class="k">def</span><span class="w"> </span><span class="nf">FromEulerKUKA</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">):</span>
</span><span id="__span-44-5">        <span class="n">sa</span><span class="p">,</span> <span class="n">ca</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">a</span> <span class="p">),</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span>
</span><span id="__span-44-6">        <span class="n">sb</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">b</span> <span class="p">),</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">b</span> <span class="p">)</span>
</span><span id="__span-44-7">        <span class="n">sc</span><span class="p">,</span> <span class="n">cc</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">c</span> <span class="p">),</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">c</span> <span class="p">)</span>
</span><span id="__span-44-8">
</span><span id="__span-44-9">        <span class="k">return</span> <span class="n">Mat4</span><span class="p">(</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">ca</span> <span class="o">*</span> <span class="n">cb</span><span class="p">,</span>
</span><span id="__span-44-10">                     <span class="n">yx</span> <span class="o">=</span> <span class="n">ca</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">*</span> <span class="n">sc</span> <span class="o">-</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">cc</span><span class="p">,</span>
</span><span id="__span-44-11">                     <span class="n">zx</span> <span class="o">=</span> <span class="n">ca</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">*</span> <span class="n">cc</span> <span class="o">+</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">sc</span><span class="p">,</span>
</span><span id="__span-44-12">
</span><span id="__span-44-13">                     <span class="n">xy</span> <span class="o">=</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">cb</span><span class="p">,</span>
</span><span id="__span-44-14">                     <span class="n">yy</span> <span class="o">=</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">*</span> <span class="n">sc</span> <span class="o">+</span> <span class="n">ca</span> <span class="o">*</span> <span class="n">cc</span><span class="p">,</span>
</span><span id="__span-44-15">                     <span class="n">zy</span> <span class="o">=</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">*</span> <span class="n">cc</span> <span class="o">-</span> <span class="n">ca</span> <span class="o">*</span> <span class="n">sc</span><span class="p">,</span>
</span><span id="__span-44-16">
</span><span id="__span-44-17">                     <span class="n">xz</span> <span class="o">=</span> <span class="o">-</span><span class="n">sb</span><span class="p">,</span>
</span><span id="__span-44-18">                     <span class="n">yz</span> <span class="o">=</span> <span class="n">cb</span> <span class="o">*</span> <span class="n">sc</span><span class="p">,</span>
</span><span id="__span-44-19">                     <span class="n">zz</span> <span class="o">=</span> <span class="n">cb</span> <span class="o">*</span> <span class="n">cc</span> <span class="p">)</span>
</span><span id="__span-44-20">
</span><span id="__span-44-21"><span class="w">     </span><span class="sd">&quot;&quot;&quot; KUKA Compatible Euler Angles</span>
</span><span id="__span-44-22"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-44-23">     <span class="k">def</span><span class="w"> </span><span class="nf">ToEulerAnglesKUKA</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-15</span> <span class="p">):</span>
</span><span id="__span-44-24">          <span class="n">b</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="__span-44-25">               <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span>
</span><span id="__span-44-26">               <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-44-27">          <span class="n">cos</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">b</span> <span class="p">)</span>
</span><span id="__span-44-28">          <span class="k">if</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">cos</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1e-15</span> <span class="p">):</span>
</span><span id="__span-44-29">              <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1">#-- !</span>
</span><span id="__span-44-30">              <span class="n">c</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">b</span> <span class="p">)</span>
</span><span id="__span-44-31">          <span class="k">else</span><span class="p">:</span>
</span><span id="__span-44-32">              <span class="n">a</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="o">/</span> <span class="n">cos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">/</span> <span class="n">cos</span> <span class="p">)</span>
</span><span id="__span-44-33">              <span class="n">c</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span> <span class="o">/</span> <span class="n">cos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="o">/</span> <span class="n">cos</span> <span class="p">)</span>
</span><span id="__span-44-34">          <span class="k">return</span> <span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">)</span>
</span><span id="__span-44-35">
</span><span id="__span-44-36"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Euler Angles from Matrix</span>
</span><span id="__span-44-37"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-44-38">     <span class="k">def</span><span class="w"> </span><span class="nf">ToEulerAngles</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-44-39">          <span class="n">x</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span><span id="__span-44-40">          <span class="n">y</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="__span-44-41">               <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span>
</span><span id="__span-44-42">               <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-44-43">          <span class="n">z</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="p">)</span>
</span><span id="__span-44-44">          <span class="k">return</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="p">)</span>
</span><span id="__span-44-45">
</span><span id="__span-44-46"><span class="w">     </span><span class="sd">&quot;&quot;&quot; Euler Angles from Matrix MD</span>
</span><span id="__span-44-47"><span class="sd">     &quot;&quot;&quot;</span>
</span><span id="__span-44-48">     <span class="k">def</span><span class="w"> </span><span class="nf">ToEulerAnglesMD</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
</span><span id="__span-44-49">          <span class="n">x</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span><span id="__span-44-50">          <span class="n">y</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="ne">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="__span-44-51">               <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span>
</span><span id="__span-44-52">               <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">X</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="__span-44-53">          <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">x</span> <span class="p">),</span> <span class="ne">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
</span><span id="__span-44-54">          <span class="n">z</span> <span class="o">=</span> <span class="ne">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
</span><span id="__span-44-55">                          <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span> <span class="p">)</span>
</span><span id="__span-44-56">          <span class="k">return</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="p">)</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2024-2025 Digital Design and Fabrication
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>